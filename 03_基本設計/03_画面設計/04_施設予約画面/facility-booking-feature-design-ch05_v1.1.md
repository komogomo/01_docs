# Chapter 05: 管理機能

**HarmoNet 施設予約機能 基本設計書**

---

## 改訂履歴

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| v1.0 | 2025-10-29 | TKD + Claude | 初版作成 |
| v1.1 | 2025-11-28 | TKD + Claude | 集会所追加、利用統計削除、連続予約はテナント設定可能に変更 |

---

## 目次

1. [管理機能概要](#1-管理機能概要)
2. [予約状況の確認](#2-予約状況の確認)
3. [代理予約](#3-代理予約)
4. [予約キャンセル](#4-予約キャンセル)
5. [予約ブロック設定](#5-予約ブロック設定)
6. [権限管理](#6-権限管理)

---

## 1. 管理機能概要

### 1.1 管理者の役割

**管理組合理事:**
- 住民からの予約に関する問い合わせ対応
- 高齢者や外国人住民への予約サポート（代理予約）
- 予約状況の把握と公平性の確認

**管理会社担当者:**
- 施設のメンテナンス計画に基づくブロック設定
- 施設修繕時の予約制限管理

### 1.2 管理機能一覧

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 予約状況確認 | 全住民の予約を一覧・カレンダーで確認 | 高 |
| 代理予約 | 住民に代わって予約を実施 | 高 |
| 予約キャンセル | 管理者権限で予約をキャンセル | 高 |
| ブロック設定 | メンテナンス等で予約不可期間を設定 | 中 |

---

## 2. 予約状況の確認

### 2.1 表示形式

**カレンダー形式:**
- 月単位のカレンダー表示
- 各日付に予約件数・稼働率を表示
- 日付クリックで詳細表示

**一覧形式:**
- テーブル形式で全予約を表示
- ソート・フィルタ機能

### 2.2 表示項目

| 項目 | 駐車場 | 集会所 |
|------|--------|--------|
| 予約日 | ○ | ○ |
| 区画/施設名 | ○ | ○ |
| 予約者（住戸番号） | ○ | ○ |
| 利用時間 | - | ○ |
| 使用目的 | - | ○ |
| 連続日数 | ○ | - |
| ステータス | ○ | ○ |

### 2.3 フィルタ機能

- 日付範囲
- 施設タイプ（集会所/駐車場）
- 区画
- 予約者（住戸番号検索）
- ステータス（予約済み/キャンセル済み/利用完了）

---

## 3. 代理予約

### 3.1 目的

- 高齢者や外国人住民のサポート
- 電話・窓口での予約依頼対応
- デジタルデバイスを持たない住民への対応

### 3.2 操作フロー

```
1. 管理画面から「代理予約」を選択
2. 対象住民を検索（住戸番号/氏名）
3. 住民情報を確認
4. 施設タイプを選択（集会所/駐車場）
5. 通常の予約フローと同様に進む
   - 日付選択
   - 区画/時間枠選択
   - （駐車場の場合）連続日数選択
   - （集会所の場合）使用目的入力
6. 予約内容を確認
7. 予約確定
8. 対象住民へ完了通知メール送信
```

### 3.3 制限ルール

- 代理予約も通常予約と同じ制限ルールが適用される
- 同日複数予約の制限（駐車場）
- 月間利用制限（駐車場: 10回/月）
- 連続予約制限（駐車場: 最大3日、テナント設定で変更可能）

### 3.4 連続予約（駐車場）

| 項目 | 値 |
|------|-----|
| デフォルト | 1日 |
| 最大 | 3日（テナント管理画面で変更可能） |
| 検証 | 連続する全日程で同一区画が空いていること |

**連続予約時の処理:**
- 選択した日数分の予約を一括作成
- キャンセル時は一括キャンセル（個別キャンセル不可）

---

## 4. 予約キャンセル

### 4.1 管理者キャンセルの目的

- 住民からの依頼によるキャンセル代行
- 緊急メンテナンス時の強制キャンセル
- 不正利用の防止

### 4.2 キャンセル処理

**通常キャンセル:**
- 住民からの依頼に基づくキャンセル
- キャンセル理由を記録
- 住民へキャンセル完了通知メール送信

**強制キャンセル:**
- 緊急メンテナンス等による管理者判断でのキャンセル
- 理由カテゴリ: メンテナンス / 緊急対応 / その他
- 住民への通知に理由を明記

### 4.3 キャンセル可能条件

- 駐車場: 利用日より前であればキャンセル可能
- 集会所: 使用開始時刻より前であればキャンセル可能
- 連続予約: 一括キャンセルのみ（部分キャンセル不可）

---

## 5. 予約ブロック設定

### 5.1 目的

- 定期メンテナンス時の予約制限
- 突発的な修繕工事への対応
- イベント開催時の施設確保

### 5.2 ブロック種類

| 種類 | 説明 | 例 |
|------|------|-----|
| 日付指定 | 特定日の全区画をブロック | 大掃除日 |
| 区画指定 | 特定区画を期間ブロック | 駐車場②の舗装工事 |
| 期間指定 | 複数日×複数区画をブロック | 集会所の改修工事 |

### 5.3 操作フロー

```
1. 管理画面から「ブロック設定」を選択
2. 施設タイプを選択
3. ブロック種類を選択
4. 対象日/区画/期間を指定
5. ブロック理由を入力
6. 既存予約の確認
   - 既存予約がある場合は警告表示
   - 強制キャンセルするか確認
7. ブロック設定を確定
```

### 5.4 既存予約との競合

- ブロック期間内に既存予約がある場合は警告表示
- 管理者の選択肢:
  - 既存予約をキャンセルしてブロック実行
  - ブロック設定を中止

---

## 6. 権限管理

### 6.1 権限レベル

| レベル | 役割 | 権限範囲 |
|--------|------|---------|
| 一般住民 | 住民 | 自分の予約のみ操作可能 |
| 管理者 | 理事/管理会社 | 全予約の閲覧・操作、代理予約、ブロック設定 |

### 6.2 権限チェック

- 管理機能へのアクセス時に権限チェック
- 権限不足の場合はエラーメッセージを表示
- ロール情報は `user_roles` テーブルで管理

---

**Document ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH05  
**Status**: 確定版  
**Created**: 2025-10-29  
**Last Updated**: 2025-11-28  
**Version**: v1.1  
**Authors**: TKD + Claude  

---

© 2025 HarmoNet Project. All rights reserved.
