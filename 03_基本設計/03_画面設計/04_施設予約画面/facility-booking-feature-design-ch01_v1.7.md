# Chapter 01: 概要・実装対象機能

**HarmoNet 施設予約機能 基本設計書**

---

## 改訂履歴

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| v1.0 | 2025-10-29 | TKD + Claude | 初版作成 |
| v1.5 | 2025-10-29 | TKD + GPT | カレンダ表示レイアウト変更 |
| v1.6 | 2025-11-28 | TKD + Claude | MVP表記削除、集会所追加、セキュレア仕様反映 |
| v1.7 | 2025-12-02 | TKD + Claude | マルチテナント対応強化、UI方針変更（タブ→ドロップダウン）、ヘッダー簡素化 |

---

## 目次

1. [はじめに](#1-はじめに)
2. [基本方針](#2-基本方針)
3. [実装対象施設（参考：セキュレア研究学園）](#3-実装対象施設参考セキュレア研究学園)
4. [画面構成・遷移](#4-画面構成遷移)
5. [将来実装機能](#5-将来実装機能)
6. [検討しない機能](#6-検討しない機能)

---

## 1. はじめに

### 1.1 目的

HarmoNet における施設予約機能の設計方針と実装範囲を定義する。

### 1.2 背景

- 従来の紙ベース・電話連絡による予約管理の課題（可視化困難、二重予約リスク、多言語非対応）を解決
- 住民がスマートフォンから簡単に施設予約できる仕組みを提供

### 1.3 施設予約機能が実現すること

**住民向け:**
- いつでもどこでも予約可能
- 空き状況の可視化
- 多言語対応（日本語・英語・中国語）

**管理者向け:**
- 予約受付の自動化
- 重複予約の防止
- 予約履歴の一元管理

### 1.4 テナント単位の運用

- すべてのデータは `tenant_id` でスコープ管理
- テナント間でデータは混在しない
- ログイン時のテナントに基づき利用可能施設を自動フィルタ

---

## 2. 基本方針

### 2.1 マルチテナント対応

施設予約機能はマルチテナント対応を前提とし、以下の項目はすべてテナント単位で設定可能とする。

| 設定項目 | 説明 | 設定テーブル |
|---------|------|-------------|
| 施設名称 | 集会所、駐車場等の名称 | facilities |
| 施設数 | テナントが保有する施設の数 | facilities |
| 区画数 | 駐車場の台数等 | facility_slots |
| 区画名 | ①②③、A1/A2等 | facility_slots |
| 利用料金 | 無料〜有料 | facility_settings |
| 料金単位 | 日単位/時間単位 | facility_settings |
| 予約単位 | 30分/60分等（分単位で設定） | facility_settings |
| 利用可能時間帯 | 開始〜終了時刻 | facility_settings |
| 月間利用制限 | 回数制限（null=無制限） | facility_settings |
| 予約可能期間 | 何ヶ月先まで予約可能か | facility_settings |
| 連続予約日数 | 最大連続予約可能日数 | facility_settings |

### 2.2 共通予約構造

- 施設種類が異なっても「予約する」行為の本質は共通
- 共通構造 + ルール定義層（`facility_settings`）のアーキテクチャで柔軟性と保守性を両立

### 2.3 ルール定義層での差異吸収

各施設の違いは `facility_settings` テーブルで吸収する。

**参考：セキュレア研究学園の設定例**

| 項目 | ゲスト駐車場 | 集会所 |
|------|-------------|--------|
| 予約単位 | 日単位（24時間/回） | 時間単位（30分刻み） |
| 利用可能時間 | 終日 | 9:00-19:00 |
| 料金 | 100円/回 | 無料 |
| 月間制限 | 10回/月 | なし |
| 予約可能期間 | 翌月末まで | 翌月末まで |
| キャンセル期限 | 前日まで | 使用開始時間前まで |
| 承認フロー | 不要 | 不要 |

※ 上記はセキュレア研究学園の設定例であり、テナント毎に異なる値を設定可能

### 2.4 UI方針

**ドロップダウン選択式:**
- 施設選択は1つのドロップダウンで切替
- テナントが保有する施設がドロップダウンの選択肢として表示される
- 施設が1つのみの場合もドロップダウン形式（将来の拡張性を考慮）

**ヘッダー構成:**
- 言語切替ボタン（JA/EN/ZH）のみ
- 画面タイトル・戻るボタンは不要（フッターナビで遷移）

**共通UI要素:**
- 月カレンダー（日付選択）
- 予約確認画面（確認・同意・確定）
- 多言語切替（JA/EN/ZH）

**施設タイプ別UI要素:**
- 集会所系: 時間枠選択 + 使用目的入力
- 駐車場系: 配置図 + 区画選択ボタン

---

## 3. 実装対象施設（参考：セキュレア研究学園）

本章の内容はセキュレア研究学園（初期テナント）の設定例である。他テナントは異なる設定となる。

### 3.1 ゲスト駐車場

**施設概要:**

| 項目 | セキュレア研究学園の設定 |
|------|-----|
| 区画数 | 8区画（①②表側、③〜⑧裏側） |
| 使用時間 | 24時間/回 |
| 料金 | 100円/回 |
| 支払方法 | 集会所の集金ボックスに入金 |
| 月間制限 | 10回/月 |
| 予約可能期間 | 翌月末まで |
| キャンセル | 前日まで |

**予約フロー:**
1. ドロップダウンで「ゲスト駐車場」を選択
2. 月カレンダーで日付選択
3. 駐車場配置図 + 区画ボタンで空き確認・選択
4. 予約確認画面（注意事項同意）
5. 予約確定

**区画ボタン状態:**
- 🟢 空き（選択可能）
- 🔴 予約済み（他ユーザー）
- 🔵 自分の予約
- ⚫ 管理者ブロック

**入力項目:**
- なし（区画選択のみ）

**注意事項（確認画面表示）:**
- 使用後は清掃をお願いします
- ゴミは各自でお持ち帰りください
- 設備の破損・汚損があった場合はご連絡ください
- キャンセルの場合は前日までにご連絡ください

---

### 3.2 集会所（セキュレアステーション）

**施設概要:**

| 項目 | セキュレア研究学園の設定 |
|------|-----|
| 利用可能時間 | 9:00-19:00（原則） |
| 予約単位 | 30分 |
| 料金 | 無料 |
| 定員 | 約30名 |
| 設備 | テーブル・椅子・プロジェクター |
| 入室方法 | 非接触カード（組合員に1枚貸与） |
| キャンセル | 使用開始時間前まで |

**予約フロー:**
1. ドロップダウンで「集会所」を選択
2. 月カレンダーで日付選択
3. 時間枠選択（30分単位、9:00-19:00）
4. 使用目的・参加人数入力
5. 予約確認画面（注意事項同意）
6. 予約確定

**入力項目:**
- 使用目的（必須）
- 参加人数（任意）

**遵守事項（確認画面表示）:**
- 原則飲酒・喫煙禁止（理事長許可で飲酒可）
- 使用後は清掃をお願いします
- ゴミは各自でお持ち帰りください
- 設備の破損・汚損があった場合はご連絡ください

**優先順位（参考）:**
1. 管理組合
2. 区会
3. 官公署
4. 居住者親睦
5. その他

---

## 4. 画面構成・遷移

### 4.1 画面一覧

| 画面 | 役割 | 遷移元 |
|------|------|--------|
| 施設予約TOP | 施設ドロップダウン選択・カレンダー・新規予約 | フッター「施設予約」 |
| 区画/時間選択 | 空き状況確認・選択 | 施設予約TOP（日付選択後） |
| 予約確認 | 内容確認・注意事項同意・確定 | 区画/時間選択 |
| 予約詳細 | 予約内容表示・変更・キャンセル | マイページのみ |

### 4.2 遷移ルール

- 予約詳細画面へのアクセスはマイページからのみ
- 施設予約画面から予約詳細への直接遷移は不可
- マイページ = 自分の予約を管理する場所
- 戻る操作はフッターナビゲーションで行う

### 4.3 カレンダー表示範囲

- 初期表示: 当月
- 表示範囲: 当月〜翌月末（`reservable_until_months` で制御）
- 過去月は非表示（マイページの予約履歴で代替）
- 前月ボタンは非活性

---

## 5. 将来実装機能

### 5.1 料金徴収の自動化

- アプリ内決済機能（クレジットカード、電子マネー等）
- テナントの要望に応じて検討

### 5.2 承認フロー

- 集会所・ゲストルーム向け
- 管理者承認が必要な施設タイプへの対応

### 5.3 HEMS連携

- 業務提携が前提
- デベロッパー・ハウスメーカーとのAPI連携

---

## 6. 検討しない機能

| 機能 | 理由 |
|------|------|
| EV充電器管理 | 予約して使うものではない |
| IoT連携（スマートロック） | 既存サービスが存在 |
| AI予測機能 | 予約には不要 |
| コミュニティ機能連携 | 掲示板は単独メニュー |
| 利用統計レポート | 管理者（一般人）は見ない |

---

**Document ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH01  
**Status**: 確定版  
**Created**: 2025-10-29  
**Last Updated**: 2025-12-02  
**Version**: v1.7  
**Authors**: TKD + Claude  

---

© 2025 HarmoNet Project. All rights reserved.
