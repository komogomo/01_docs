# 第4章: 投稿詳細画面（BoardDetail）

**掲示板機能 基本設計書 v2.5（HarmoNet準拠）**

[← 第3章](board-design-ch03_latest.md) | [目次に戻る](board-design-ch00-index_latest.md) | [第5章 →](board-design-ch05_latest.md)

---

## 🆕 ChangeLog (v2.5 / 2025-11-21)

* 文書種別を「基本設計書」に統一（実装レベルの技術要素・API名を削減）
* PDFプレビュー仕様を掲示板詳細画面専用の要件として明示（TOP画面ではプレビュー不要）
* 翻訳機能を「将来拡張（投稿本文・コメント向け）」として整理し、MVPでは UI 静的多言語のみと定義
* 音声読み上げ機能を「投稿本文中心／掲示板画面のみ」に限定し、目的と適用範囲を簡素化
* スループット制限・GPU 等の非機能を本章から切り出し、別途 NFR / 詳細設計側に委譲
* 共通メッセージ仕様との役割分担を明記（エラー・空状態文言は共通設計に準拠）

---

## 4.1 画面概要

投稿詳細画面（BoardDetail）は、掲示板TOP（/board）から選択された 1 件の投稿を「落ち着いて読む」ための画面である。

* パス: `/board/[id]`
* 主な役割:

  * 投稿本文・添付ファイル（PDF等）・コメントを 1 画面で確認できるようにする。
  * 回覧板種別の投稿については、既読状況の確認を可能にする。
  * 必要に応じて、音声読み上げなどの支援機能で閲覧環境の差を補う。
* 前提:

  * 表示対象は、ログイン中テナントのうち、ユーザが閲覧権限を持つ投稿のみ（GLOBAL／所属グループ）。
  * AIモデレーション・自動翻訳はなくても運用可能な設計とし、導入する場合は ch06 で定義される共通仕様を利用する。

---

## 4.2 ヘッダー構成

### 4.2.1 要素

* 戻るボタン

  * BoardTop（/board）へ戻る。
  * 元のタブ・範囲・ページ番号を可能な範囲で復元（詳細は BoardTop 詳細設計側）。
* 画面タイトル

  * 例: 「掲示板」「投稿詳細」等。HOME／BoardTop と同一トーン。
* コンテキストメニュー

  * 通報（すべての閲覧ユーザ）
  * 編集・削除（投稿者本人または管理権限ユーザのみ）
  * その他（ピン留め、回覧板締切変更など）は将来拡張として検討。

### 4.2.2 デザイン方針

* AppHeader の共通ルールに従い、余白を十分にとったシンプルなヘッダーとする。
* 戻るボタンのタップ領域を広く確保し、片手操作でも誤タップを防ぐ。

---

## 4.3 投稿本文エリア

### 4.3.1 表示内容

* 投稿タイトル
* カテゴリラベル（NOTICE / RULES / その他）
* メタ情報

  * 投稿日時 / 投稿者種別（管理組合 / 一般住民 等）
  * 回覧板種別の場合は、締切日など必要な情報
* 本文

  * 最大文字数の目安のみ定義（例: 2000〜4000 文字程度）。
  * 長文の場合も同一画面で全文をスクロール閲覧できるようにする。

### 4.3.2 レイアウト方針

* タイトル・カテゴリ・メタ情報を上部にコンパクトにまとめ、その下に本文を配置する。
* 本文のフォントサイズはスマートフォンでも読みやすい大きさを基準とし、左右の余白を十分にとる。

### 4.3.3 翻訳・言語に関する整理

* 投稿のタイトルおよび本文は、投稿作成・更新時に元言語から日本語・英語・中国語（簡体字）の3言語へ自動翻訳し、キャッシュとして保持する。
* 投稿詳細画面では、LanguageSwitch のアクティブ言語に対応するキャッシュ済み訳文を本文として表示する。
* 必要に応じて「原文を表示」リンク等を設け、元の投稿言語を参照できるようにするかどうかは、詳細設計で定義する。
* コメントについては、当面は自動翻訳の対象外とし、将来拡張として ch06 で検討する。

---

## 4.4 添付ファイル表示エリア（PDFプレビュー含む）

### 4.4.1 添付ファイル一覧

* 本文直下に「添付ファイル」セクションを配置し、投稿に紐づくファイルを一覧表示する。
* 表示項目の例:

  * ファイル名
  * ファイル種別（PDF / 画像 等）のアイコン
  * ファイルサイズ（任意）
* 添付数はシステム全体の制約に従う（例: 最大 5 件）。

### 4.4.2 PDFプレビュー（掲示板詳細画面専用仕様）

* PDF ファイルをタップすると、アプリ内モーダルでプレビュー表示する。
* モーダルの基本挙動:

  * 画面中央に PDF ビューアを表示し、背景は半透明のオーバーレイ。
  * 上部に「閉じる」テキストまたは ✕ アイコンを小さく表示。
  * 画面下部中央に「タップで閉じる」等のガイドテキストを表示。
  * モーダル全体のタップで閉じるが、PDFのスクロール操作を妨げないよう領域を分ける（詳細は UI 実装側）。
* TOP（/board）では PDF プレビューを行わず、「添付あり」を示すアイコンのみとし、詳細画面で初めてプレビュー可能とする。

### 4.4.3 その他ファイル種別

* 画像ファイルなど、即時閲覧性が高いものはサムネイル表示を検討する。
* Office系ファイル等は、端末環境に依存するため、基本は「ダウンロード／外部アプリで開く」想定とし、MVPでは詳細なビューアは提供しない。

---

## 4.5 コメント表示エリア

### 4.5.1 構造

* コメントは 1 階層構造とし、スレッド化しない。
* 表示順序は原則 `created_at` 昇順（古いコメントが上）とし、読み進めやすさを優先する。
* 各コメントは次の情報を持つ。

  * コメント投稿者（表示名）
  * 投稿日時
  * 本文
  * 必要に応じて「編集済み」ラベル

### 4.5.2 表示・操作

* 投稿本文の直下にコメント一覧を表示し、画面下部にコメント入力欄を配置する構成を基本とする。
* コメントの翻訳や音声読み上げは、将来的には投稿本文と同様の枠組みで提供可能とするが、MVP では「日本語・英語の混在を許容し、必要に応じて手動で翻訳アプリ等を利用」する前提とする。
* 誹謗中傷等に対する通報機能は、コメント単位にも配置可能な設計とし（アイコンなど）、詳細はモデレーション仕様（ch06）に委ねる。

---

## 4.6 既読状況エリア（回覧板投稿のみ）

### 4.6.1 表示対象

* 投稿種別が「回覧板」の場合のみ、既読状況エリアを表示する。

### 4.6.2 表示内容の例

* 「既読: 12 / 30 世帯（40%）」のような形式で、

  * 既読数
  * 対象世帯数
  * 割合（%）
    を簡易に表示する。
* 詳細な既読者一覧や時刻などは、MVPでは必須とせず、将来拡張とする。

### 4.6.3 目的

* 管理者が回覧板の周知状況を把握できるようにする。
* 住民側には「既読操作をすることで参加した感覚」を持ってもらうことを狙うが、UIとしては押しつけにならないよう控えめな表現とする。

---

## 4.7 メッセージ表示・エラー・空状態

### 4.7.1 投稿取得失敗時

* 投稿本体の取得に失敗した場合は、画面中央にエラーメッセージと「再読み込み」ボタンを表示する。
* 文言は共通メッセージ仕様に従い、多言語対応されたキーを利用する。

### 4.7.2 コメント取得失敗時

* 投稿本文は表示できているがコメント取得に失敗した場合、コメントエリアに限定してエラーメッセージを表示する。
* コメント入力を制限するかどうかは、エラー種別に応じて詳細設計で定める。

### 4.7.3 空状態

* コメントが 1 件もない場合:

  * 「まだコメントはありません。」など、簡潔なメッセージを表示。
  * 権限があるユーザには「最初のコメントを投稿してみましょう。」等の案内を表示することも検討する。

---

## 4.8 音声読み上げ（掲示板画面限定）

### 4.8.1 適用範囲

* 音声読み上げ対象は「投稿本文」を中心とし、掲示板機能の画面（TOP・詳細）に限定する。
* 静的な UI テキストや、他の画面（HOME 等）への一括適用は行わない。

### 4.8.2 UI 上の配置

* 投稿本文エリア付近に「音声で聞く」リンクまたはボタンを配置する。
* 押下時に、現在表示中の言語（またはユーザの UI 言語設定）に応じた音声で本文を読み上げる。

### 4.8.3 設計方針

* 高齢者・視覚に課題のある利用者・小型端末利用者に配慮し、「読む」だけでなく「聞く」手段を提供することを主目的とする。
* 音声エンジンの種類やキャラクターなどの詳細は、本章では規定せず、非機能・コスト面を含めた別資料で検討する。

---

## 4.9 将来拡張（翻訳・AIモデレーションとの連携）

本章では詳細には扱わないが、投稿詳細画面は次のような拡張とも親和性を持つ前提で設計する。

* 投稿本文・コメントの自動翻訳と翻訳キャッシュ
* 投稿内容の AI 自動モデレーション結果の表示（「要確認」「問題なし」など）
* 通報履歴やモデレーションログの簡易表示

これらは掲示板共通仕様（ch06）で定義されるロジックを利用し、UIとしては本文下・コメント横・ヘッダー付近など、控えめな位置に情報を配置する想定とする。

---

## 4.10 設計意図まとめ

1. **読む・添付を見る・コメントするを 1 画面に集約**

   * 投稿本文・PDF・コメント・回覧板の既読状況をまとめて確認できる構成とし、「情報を追いかける手間」を減らす。

2. **掲示板らしい「安心感」を重視**

   * 通報・削除はヘッダーのメニューにまとめ、必要なときだけ見える位置に配置。
   * 住民が萎縮しすぎず、かつ不安にならないバランスを目指す。

3. **音声・翻訳などの支援機能は“過度に主張しない”**

   * 音声読み上げや翻訳は、あくまで補助的なボタンとして控えめに配置し、基本体験は「静かな掲示板」に留める。

4. **MVP と将来拡張の境界を明確にする**

   * MVP では UI 多言語・PDF プレビュー・回覧板既読といった最低限の機能に集中し、
     翻訳・AIモデレーションなどコストの大きい機能は別章・別フェーズで柔軟に検討できるようにする。

---

**Document ID:** SEC-APP-BOARD-DESIGN-002-CH04
**Version:** 2.5
**Created:** 2025-10-27
**Last Updated:** 2025-11-21
**Author:** TKD + GPT (HarmoNet PMO)
