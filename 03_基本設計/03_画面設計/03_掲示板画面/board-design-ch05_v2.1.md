# 第5章: 投稿作成画面（新規・編集）

**掲示板機能 基本設計書 v2.1（HarmoNet準拠）**

[← 第4章](board-design-ch04_latest.md) | [目次に戻る](board-design-ch00-index_latest.md) | [第6章 →](board-design-ch06_latest.md)

---

## 🆕 ChangeLog (v2.1 / 2025-11-21)

* 文書レイヤーを「基本設計」に統一（AIモデレーション詳細・NGワード実装仕様を削除）
* 機能要件 v1.6 / 技術スタック v4.4 / BBS Design-decision-summary v1.0 に沿って、投稿時3言語自動翻訳 + キャッシュ前提を明示
* 新規作成／編集の共通画面として再定義し、承認フロー（draft / approver / published）との関係を整理
* 回覧板作成（管理者向け）を「投稿フォームに追加されるオプション項目」として位置づけ
* バリデーション仕様を、必須・文字数・添付制限の方針レベルに整理（メッセージ文言は共通メッセージ仕様に委譲）

---

## 5.1 画面の役割

投稿作成画面は、掲示板に新しい記事を作成・編集するための画面である。

* 対象: 一般住民・管理組合・管理会社など、投稿権限を持つユーザ
* 画面種別:

  * 新規投稿: 既存記事を持たず、空のフォームから作成
  * 編集: 既存記事を読み込み、内容を更新
* 主な役割:

  * タイトル・本文・カテゴリ・公開範囲・添付ファイルを入力する
  * 投稿種別（通常投稿／回覧板／ルール等）を指定する
  * 保存時に 3 言語自動翻訳をトリガし、翻訳キャッシュを更新する
  * 管理者の場合は、承認フロー（下書き → 承認者確認 → 公開）に沿った状態を設定できる

---

## 5.2 画面構成

### 5.2.1 ヘッダー

* 左: 戻る（× / 「キャンセル」）

  * タップで一覧画面（または遷移元）へ戻る。
  * 入力内容がある状態で離脱する場合は、確認ダイアログを表示する方針とする。

* 中央: 画面タイトル

  * 新規投稿: 「新規投稿」
  * 編集: 「投稿を編集」

* 右: 保存ボタン

  * ラベル例:

    * 一般ユーザ: 「投稿する」
    * 管理者（下書き保存機能あり）の場合: 「保存」「下書き保存」「公開」などの区別は詳細設計で定義。
  * 入力必須項目が満たされない間は非活性表示とする。

### 5.2.2 注意・ガイド表示

* 画面上部に、掲示板利用ルールへのリンクを含む簡易な注意文を配置する。

  * 例: 「誹謗中傷・差別的な表現は禁止されています。詳しくは投稿ガイドラインをご覧ください。」
* 旧版にあった「AIが自動でブロック／変換する」強い表現は削除し、

  * 実際の仕様に合わせて「利用規約 + 通報／削除が軸」であることを示す。
* 注意表示は常時または折りたたみ形式など、UI 詳細は App 全体のガイドラインに沿って決める。

### 5.2.3 入力フォーム（共通）

投稿作成画面の主要入力項目は以下とする。

1. カテゴリ（必須）

   * 掲示板種別やタグ（NOTICE / RULES / その他）に紐づく項目。
   * 住民には自分が投稿可能なカテゴリのみを表示し、管理者は全カテゴリ（回覧板含む）を選択可能とする。

2. タイトル（必須）

   * 1 行テキスト入力。
   * 最大文字数の目安: 50 文字。

3. 本文（必須）

   * 複数行テキスト入力。
   * 最大文字数の目安: 2000 文字程度とし、詳細な上限値は要件定義と合わせて決定する。

4. 公開範囲

   * GLOBAL（テナント全体） / GROUP（所属グループ）などから選択。
   * GROUP 選択時は、ユーザが所属するグループのみ選択可能とする。

5. 添付ファイル

   * PDF / 画像などを添付可能とする（詳細な制約値は非機能要件・ストレージ要件に準拠）。
   * サムネイルまたはファイル名リストでプレビューを表示する。

6. その他オプション

   * ピン留め（管理者のみ）
   * コメント可否（将来拡張を含めて ch06 で定義）

---

## 5.3 バリデーション方針

詳細なメッセージ文言や実装は別途共通メッセージ仕様・詳細設計に委ね、本章では方針のみ定義する。

### 5.3.1 必須項目

* カテゴリ / タイトル / 本文 は必須とする。
* 未入力の場合は、フィールド直下にエラーを表示し、保存ボタンを非活性または保存時にブロックする。

### 5.3.2 文字数

* タイトル: 最大 50 文字程度を推奨とする。
* 本文については、システム共通の「絶対上限」と、テナントごとに設定可能な「テナント上限」の二段階を設ける。

  * システム絶対上限### 5.3.3 添付ファイル

添付ファイルについても、システム共通の「絶対上限」とテナントごとの「テナント上限」を設ける。

* システム絶対上限

  * 1投稿あたりの添付ファイル数の絶対上限は 10 個とする。
  * 1ファイルあたりのサイズの絶対上限は 5MB とする。
* テナント上限（テナント管理者が設定可能）

  * 添付ファイル数上限: 1〜10 の範囲で設定可能。未設定時は 5 個を適用する。
  * 1ファイルあたりのサイズ上限: 1〜5MB の範囲で設定可能。未設定時は 5MB を適用する。
* フロントエンドおよびバックエンドは、テナント上限と絶対上限の両方を満たすようにバリデーションを行い、制限を超えたファイルはアップロード前に明示的なエラーメッセージで通知する。

### 5.3.4 不適切表現で、最大 5 ファイル、合計 10MB まで等。

* 対応ファイル種別（PDF / 画像 / Office 等）は技術スタック・ストレージ要件と整合させる。
* 制限を超えた場合は、該当ファイルのみを拒否し、理由を表示する。

### 5.3.4 不適切表現への対応（方針レベル）

* NGワードや誹謗中傷表現の検知は、将来 AI モデレーションやサーバ側ロジックで行うことを想定し、

  * 本画面では「ガイドラインへの誘導」を中心とした UI に留める。
* 入力中リアルタイムでの過度な警告ポップアップは避け、ユーザ体験を損なわない範囲で注意表示を行う。
* 具体的な NG ワードや判定ロジックは ch06（共通仕様）およびサーバ側設計に委譲する。

---

## 5.4 保存・翻訳・承認フローとの関係

### 5.4.1 保存アクションの種類

投稿作成画面からの保存アクションは、ロールにより異なる。

* 一般住民

  * 「投稿する」: 即時公開または「住民投稿」ステータスで保存（承認が必要な場合はサーバ側フローで制御）。

* 管理者（理事・管理会社等）

  * 「下書き保存」: draft 状態で保存し、一覧には表示しない（または管理者のみ表示）。
  * 「公開する」: approver/published 状態に遷移させるボタンを将来的に用意する想定。

詳細なステータス遷移（draft → approver → published）は、掲示板共通仕様および管理者画面の設計にて定義する。

### 5.4.2 3言語自動翻訳とキャッシュ更新

* 新規投稿・編集で本文が変更された場合、保存時に次の処理を行う。

  * 元本文（投稿者の入力言語）を基準として、JA / EN / ZH への自動翻訳を実行。
  * 翻訳結果を translation_cache 等に保存し、BoardTop / 詳細 / HOME の各画面から参照できるようにする。
* 通常の閲覧時は、LanguageSwitch のアクティブ言語に対応するキャッシュ済み訳文を表示し、ユーザに翻訳操作を意識させない。

### 5.4.3 翻訳ボタン（キャッシュ更新用）

* 翻訳キャッシュの有効期限切れや翻訳エラーが発生した場合に備え、

  * 詳細画面等に「翻訳を更新」ボタンを配置し、権限のあるユーザが再翻訳をトリガできる設計とする。
* 投稿作成画面には原則として翻訳ボタンは配置せず、

  * 「保存時に自動で翻訳される」前提で設計する。
* 翻訳ボタンの詳細仕様・エラーハンドリングは ch06（共通仕様）で定義する。

---

## 5.5 回覧板作成（管理者向けオプション）

### 5.5.1 回覧板フラグ

* 管理者が投稿を回覧板として扱う場合、投稿フォーム内に「回覧板として投稿」チェックボックスを提供する。
* チェック時の挙動（例）:

  * コメントを禁止または制限する。
  * 回覧板用の既読管理フラグを有効にする。
* 既読状況の表示や期限設定は、詳細設計および ch04 / ch06 側で扱う。

### 5.5.2 対象グループ選択

* 公開範囲の一種として、回覧板の対象を次のいずれかから選択する。

  * 全体（テナント全住民）
  * 特定グループ（棟・フロア・コミュニティ等）
* GROUP 回覧板は、対象グループの住民だけが閲覧できる。

### 5.5.3 既読期限（将来拡張）

* 将来的に、回覧板の既読期限や未読者へのリマインド通知などを設定できるようにする。
* 本章では「既読期限」項目の存在のみを想定し、

  * 日付選択
  * 未読者への通知 ON/OFF
    などの UI は詳細設計で定義する。

---

## 5.6 設計意図まとめ

1. **投稿体験のシンプルさ**

   * 必須項目とバリデーションを最小限に絞りつつ、必要な情報（カテゴリ・範囲・添付）を迷わず入力できる構造とする。

2. **3言語自動翻訳を前提としたフォーム**

   * 投稿者は自分の得意な言語で入力するだけでよく、翻訳操作を意識させない設計とする。
   * 翻訳キャッシュの更新はバックエンドおよび一部の管理 UI に委ねる。

3. **モデレーションはガイドライン中心**

   * 住民への啓発と通報機能を軸とし、AI モデレーションは共通仕様（ch06）で段階的に追加できるようにする。

4. **回覧板を通常投稿フォームの拡張として扱う**

   * 別画面ではなく、同じ投稿画面に追加項目（回覧板チェック・グループ選択・既読期限など）を持たせることで、UI の一貫性を保つ。

---

**Document ID:** SEC-APP-BOARD-DESIGN-002-CH05
**Version:** 2.1
**Created:** 2025-10-27
**Last Updated:** 2025-11-21
**Author:** TKD + GPT (HarmoNet PMO)
