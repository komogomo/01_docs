# HOME 基本設計書 ch03：お知らせセクション

**Document:** HOME画面 基本設計書（コンテンツ領域）
**Chapter:** 3 / 4
**Version:** v1.2
**Updated:** 2025/11/21
**Author:** TKD / Tachikoma
**Supersedes:** home-feature-design-ch03_v1.1.md

---

## 3.1 役割（Role）

お知らせセクションは、HOME 画面の最上位に配置される「重要なお知らせのハイライト表示」領域である。

* 管理組合からの **重要なお知らせ（NOTICE タグ付き掲示）** を、HOME 上部で簡潔に提示する。
* 利用者が HOME を開いた瞬間に、「重要なお知らせがあるかどうか」が一目で分かることを目的とする。
* 掲示板TOP との関係：

  * 掲示板TOP は ALL / NOTICE / RULES などを切り替え可能な一覧ビュー。
  * HOME お知らせセクションは、そのうち NOTICE のごく一部（最大 3 件）をチラ見せするビュー。

雑談板は設けず、掲示板は「公式な情報」を扱う場とするため、
本セクションも公式なお知らせ（NOTICE）のみを表示対象とする。

---

## 3.2 データソース・抽出条件

### 3.2.1 データソース

* 掲示板投稿テーブル（例：`board_posts`）をデータソースとする。
* HOME 画面の利用者が所属する `tenant_id` に紐づく投稿のみを対象とする。

### 3.2.2 抽出条件（概要）

お知らせセクションに表示する投稿は、以下の条件を満たすものとする。

1. 対象テナントの投稿であること
2. タグ（またはカテゴリ）が `NOTICE` に該当すること
3. 公開期間内であること

   * 公開開始日時 <= 現在時刻
   * 公開終了日時が指定されている場合は、現在時刻 <= 公開終了日時
4. RLS ポリシーにより、当該ユーザに閲覧権限が付与されていること

RLS・インデックス設計・クエリの詳細は、掲示板詳細設計書側で定義する。
本章では「HOME がどのような論理条件で投稿を扱うか」のみを定義する。

### 3.2.3 ソート順

重要度と新しさの両方を考慮し、ソートは以下の優先順位とする。

1. `pinned` フラグ（固定表示）：true → false
2. 投稿日時（`created_at`）：新しい順

`pinned` の有無は掲示板側の管理機能で制御し、
HOME ではソート結果をそのまま利用する。

---

## 3.3 表示件数・テナント設定

### 3.3.1 デフォルト表示件数

* デフォルト表示件数は **2件** とする。
* HOME 画面の縦方向の情報量を抑えつつ、
  最大 2件までであれば視認性・可読性のバランスがよいことを前提とする。

### 3.3.2 テナント設定による変更

* テナント設定により、表示件数を 1〜3件の範囲で変更可能とする。
* HOME 上での表示上限は **3件** とし、それ以上は表示しない。
* 実際の表示件数は以下で決定される：

  * `表示件数 = min(テナント設定値, NOTICE 投稿件数, 3)`

テナント設定項目の物理項目名・格納先テーブルは、
テナント設定設計書側で定義する（本章では「仕様として 1〜3件を許容」とのみ記載）。

### 3.3.3 0件時の扱い

NOTICE タグ付きの公開中投稿が 1件も取得できなかった場合、
お知らせカードは描画せず、代わりに次の文言のみ表示する。

* 「現在表示するお知らせはありません。」

この文言は StaticI18nProvider による i18n キーで管理する。

---

## 3.4 UI 構造・ワイヤーフレーム

### 3.4.1 セクション全体

```
┌──────────────────────────┐
│ セクションタイトル行                        │
│  「最新のお知らせ」                         │
├──────────────────────────┤
│ お知らせカード #1                           │
├──────────────────────────┤
│ お知らせカード #2                           │
├──────────────────────────┤
│ （最大3件まで）                             │
└──────────────────────────┘
```

* セクションタイトルは固定文字列「最新のお知らせ」（i18n 対応）とする。
* タイトル直下に、1〜3件のカードを縦方向に並べる。

### 3.4.2 カード構造

各カードのワイヤーフレームは次の通りとする。

```
┌────────────────────────────┐
│ [バッジ: お知らせ]     2025/11/21           │
│ タイトルタイトルタイトルタイトル…（最大2行）│
│                                        ＞  │
└────────────────────────────┘
```

* 1行目：

  * 左側：小さなラベルバッジ（Static テキスト「お知らせ」）
  * 右側：投稿日（`YYYY/MM/DD` 形式）
* 2行目：

  * 投稿タイトル（最大 2行表示。3行目以降は…で省略）
* 右端：

  * 「＞」アイコン、もしくは「詳細」テキスト（タップ可能領域はカード全体）

アイコンについては、必要に応じて lucide-react の `ChevronRight` 等を用いる。
カード全体は、タップ時に掲示板詳細画面へ遷移する。

### 3.4.3 0件時の UI

0件時は、セクションタイトルの直下にテキストのみを表示する。

```
┌──────────────────────────┐
│ セクションタイトル：最新のお知らせ        │
├──────────────────────────┤
│ 現在表示するお知らせはありません。        │
└──────────────────────────┘
```

カード風の枠は描画せず、余計な期待感を与えない。

---

## 3.5 遷移・挙動

### 3.5.1 カードタップ時

* カード全体をタップ可能領域とし、タップ時に掲示板詳細画面へ遷移する。
* 遷移先 URL の例：

  * `/board/{postId}`
* 実際の URL パターンおよびパラメータ設計は、掲示板詳細設計書で定義する。

### 3.5.2 一覧への導線（任意）

将来的に、セクション下部に「すべてのお知らせを見る」導線を設ける余地を残しておく。

* ラベル例：「すべてのお知らせを見る」
* 遷移先の例：`/board?tag=NOTICE`
* MVP 段階では、この導線は非表示またはリンク無効とし、HOME のレイアウトに影響を与えない。

本書では「導線候補」として位置づけ、実装有無は後続の詳細設計・実装フェーズで決定する。

---

## 3.6 アクセシビリティ・多言語対応

### 3.6.1 アクセシビリティ

* カード全体を 1つのリンク（ボタン）として扱い、キーボードフォーカス可能とする。
* スクリーンリーダー向けには、

  * タイトル全文
  * 投稿日時
    を読み上げるテキストを構成し、タイトル省略時でも全文が分かるようにする。
* バッジ（「お知らせ」）は視覚的なラベルの役割であり、
  アクセシビリティ上は必須ではないが、読み上げテキストに含めてもよい。

### 3.6.2 多言語対応

* セクションタイトル（「最新のお知らせ」）、
  0件時メッセージ（「現在表示するお知らせはありません。」）、
  一覧導線ラベル（「すべてのお知らせを見る」）は、StaticI18nProvider による静的 i18n キーで管理する。
* 掲示板投稿のタイトル・本文はユーザー生成コンテンツであり、
  自動翻訳や多言語入力は本書の範囲外とする。

---

## 3.7 本章まとめ

* HOME 画面の最上位セクションとして、**NOTICE タグ付き掲示の一部を 1〜3件表示** する。
* デフォルト表示件数は 2件であり、テナント設定により 1〜3件の範囲で調整可能とする（上限3件）。
* 掲示板投稿は、`NOTICE` タグ＋公開期間＋RLS による閲覧権限を満たしたものだけを対象とする。
* カード構造は「バッジ＋日付＋タイトル＋詳細導線」のシンプルなレイアウトとし、
  最重要情報を簡潔に伝えることを優先する。
* 遷移先 URL やフィルタキー（NOTICE など）の詳細は掲示板詳細設計書に委譲し、
  HOME 側は「NOTICE のハイライトビュー」という役割に専念する。

---

**End of Document**
