# HomePage 詳細設計書 ch01：概要

**Document:** HomePage 詳細設計書（/home コンテンツ領域）
**Chapter:** 1 / 8
**Component ID:** H-00 HomePage
**Version:** v1.0
**Date:** 2025-11-21
**Author:** TKD / Tachikoma
**Status:** Draft

---

## 1.1 本章の目的

本章は、HarmoNet のログイン後トップ画面である **HomePage（/home）** の詳細設計において、
H-00 HomePage コンポーネント群の **全体像・役割・前提条件** を整理することを目的とする。

* 利用者視点での HomePage の役割
* LoginPage / 共通部品 / 掲示板との関係
* 本詳細設計（ch02〜ch08）の対象範囲と非対象範囲

を明確化し、以降の章で定義する JSX 構造・Props・状態管理・テスト観点の上位前提とする。

---

## 1.2 対象画面・URL

* 画面名：HomePage（HOME 画面）
* URL：`/home`
* 位置づけ：

  * Supabase Auth（MagicLink）による認証・セッション確立後に遷移する、ログイン後のポータル画面。
  * アプリ起動直後（認証済み状態）のデフォルト画面としても利用する。

### 1.2.1 遷移元（想定）

* A-00 LoginPage 詳細設計で定義されたログインフローの完了時：

  * MagicLink による認証 → `/auth/callback` → セッション確立 → `/home` へ遷移
* 将来、別画面から「HOME に戻る」リンクを設ける場合も、本コンポーネントを再利用する。

### 1.2.2 遷移先（HOME からの導線）

本詳細設計のスコープでは、HOME からの遷移先画面は **UI 上の導線のみ** を定義し、
遷移先の画面実装・仕様は各詳細設計書に委譲する。

* 掲示板TOP（ALL / NOTICE / RULES フィルタ）
* 掲示板詳細（お知らせカードからの遷移）
* 施設予約画面
* 運用ルール画面（または RULES フィルタの掲示板）
* アンケート画面（旧「通知設定」カードを用途変更）
* テナント管理画面（/t-admin/users、`tenant_admin` のみ表示）

---

## 1.3 HomePage の役割

### 1.3.1 利用者視点の役割

HomePage は、ログイン直後の利用者が最初に触れるポータル画面として、次の役割を持つ。

1. **重要なお知らせの提示**

   * 管理組合からの NOTICE タグ付き掲示のうち、1〜3件を HOME 上部に表示し、
     重要なお知らせの存在を一目で分かるようにする。

2. **よく使う機能への入口**

   * 掲示板（ALL/NOTICE/RULES）、施設予約、運用ルール、アンケート等、
     利用頻度の高い機能への入口を 2×3 のカードタイルとして一覧表示する。
   * テナント管理者向けの「テナント管理」カードは、
     `tenant_admin` ロールを持つユーザにのみ表示する。

3. **将来拡張を見据えたポータル**

   * タイル構成は将来の機能追加（アンケート、申請フォーム等）を見据えた設計とし、
     MVP 段階ではダミータイルを含めつつ、レイアウトと UI トーンを先に固める。

### 1.3.2 システム視点の役割

* 認証完了後の **最初の画面** として、システム状態（認証済み／テナント所属）を前提に動作する。
* 認可（RLS）や権限は掲示板・施設予約・通知設定側の責務とし、HomePage 自身は
  「表示可能な情報だけを受け取り、提示する」構造に徹する。
* UI コンポーネントとしては、AppHeader / AppFooter 等の共通部品と結合した
  1ページアプリケーション（Next.js App Router の page.tsx）として構成する。

---

## 1.4 スコープ（対象範囲）

本詳細設計（ch01〜ch08）が扱う範囲は、以下のコンポーネントと振る舞いである。

### 1.4.1 対象コンポーネント

* `/app/home/page.tsx`

  * HomePage のエントリポイント。
  * AppHeader / Home コンテンツ領域 / AppFooter を組み合わせたページコンポーネント。

* `HomeNoticeSection`（コンポーネント名は詳細設計で確定）

  * HOME 上部の「最新のお知らせ」セクションを描画する。
  * NOTICE タグ付き掲示の一部（最大 3件）のタイトル・日付をカードとして表示する。

* `HomeFeatureTiles` / `HomeFeatureTile`

  * 機能タイル 2×3 のコンテナおよび単一タイルコンポーネント。
  * お知らせ／掲示板／施設予約／運用ルール／通知設定／ダミーの 6枚を表示する。

* 必要に応じて定義する補助コンポーネント（例）

  * `HomeSectionContainer`（セクションタイトル＋ボディのラッパ）
  * `HomeTileGrid`（2×3 レイアウトを担うコンテナ）

* 機能タイルの UI・挙動

  * 上段：お知らせ／掲示板／施設予約
  * 下段：運用ルール／アンケート／テナント管理
  * 「テナント管理」タイルは、現在テナントに対して `tenant_admin` ロールを持つユーザにのみ表示する。
    一般利用者には表示しない。
  * 通知 ON/OFF 設定は本画面では扱わず、マイページ内の設定項目として扱う。
  * `isEnabled` フラグによるリンク有効／無効の制御は従来どおりとし、
    実装済み機能のみ有効化する。

---

## 1.5 非スコープ（対象外）

HomePage 詳細設計では、以下の内容は対象外とし、他設計書・他コンポーネントの責務とする。

### 1.5.1 認証・認可・RLS

* Supabase Auth によるログイン／ログアウトフローの詳細
* `/auth/callback` におけるセッション確立ロジック
* RLS ポリシー・テーブル定義・サーバサイドの認可処理

これらは、LoginPage／MagicLinkForm／AuthCallbackHandler／DB・RLS 設計書の範囲とする。

### 1.5.2 掲示板・施設予約・通知設定側の詳細

* 掲示板TOP／掲示板詳細／投稿作成画面の UI・ロジック
* 施設予約画面（カレンダー表示・予約処理）
* 通知設定画面（通知チャンネル・カテゴリの定義）

HomePage からはこれらへの導線のみを定義し、画面本体の仕様は各詳細設計書に委譲する。

### 1.5.3 共通部品

* AppHeader（C-01）
* LanguageSwitch（C-02）
* StaticI18nProvider（C-03）
* AppFooter（C-04）

レイアウト上は HomePage に含まれるが、コンポーネント仕様・Props・スタイルは
共通部品の詳細設計書に従い、本書では「どう配置し、どう結合するか」のみ扱う。

### 1.5.4 i18n JSON 実体・Supabase クエリ実装

* `home.json` 等の i18n 定義ファイルの実体（キーと文言）
* Supabase クライアントコード（`createClient` 等）と SQL クエリ

これらは、i18n・データアクセスの共通方針に従って別途定義し、
HomePage 詳細設計では「どのキー／どのデータを使うか」のみを指定する。

---

## 1.6 前提条件・制約

### 1.6.1 技術前提

* Next.js 16（App Router）
* React 19 / TypeScript 5 系
* Supabase（PostgreSQL + RLS）
* StaticI18nProvider による 3 言語（ja / en / zh）切替
* デザインガイドライン：

  * 白基調・Apple カタログ風
  * BIZ UD ゴシック系フォント
  * 角丸 2xl、控えめなシャドウ、余白多め

### 1.6.2 ビジネス・運用前提

* 掲示板は雑談板を持たず、すべて「公式情報」の掲示として扱う。
* HOME 上のお知らせセクションでは、NOTICE タグ付き掲示のみを対象とする。
* HOME 画面はログイン必須であり、未ログイン状態から直接アクセスされた場合の扱いは、
  LoginPage 側の責務とする（HomePage ではガードロジックを持たない）。

### 1.6.3 MVP スコープ前提

* 初期実装（MVP）では、以下を前提とする：

  * お知らせセクションはダミーデータによる表示で開始し、Supabase 連携は後続タスクとする。
  * 機能タイル 6枚は、すべて `isEnabled = false`（リンク無効）で実装し、
    見た目とレイアウトの確認を優先する。
* 将来、掲示板・施設予約・通知設定が実装された段階で、
  HomePage からの導線を `isEnabled = true` に変更し、Link／Router を有効化する。

---

## 1.7 本詳細設計（ch02〜ch08）との関係

* ch02：画面構成・コンポーネント構造

  * `/home` の JSX 構造とコンポーネントツリーを定義する。
* ch03：コンポーネント仕様（Props / State / 型定義）

  * `HomePage` / `HomeNoticeSection` / `HomeFeatureTiles` 等の Props・State・型を定義する。
* ch04：データ連携・状態管理

  * NOTICE ハイライト・タイル定義・テナント設定の扱いを設計する。
* ch05：画面挙動・状態遷移・メッセージ仕様

  * 0件時・リンク無効時の挙動、HOME 固有メッセージの仕様を定義する。
* ch06：結合構成（共通部品・他画面との関係）

  * AppHeader/AppFooter/StaticI18nProvider、LoginPage、掲示板等との結合を整理する。
* ch07：テスト観点・Jest/RTL ケース一覧

  * 単体テスト・コンポーネントテストの観点を列挙する。
* ch08：改訂履歴（ChangeLog）

  * HomePage 詳細設計全体の変更履歴を管理する。

本 ch01 は、これら後続章の上位設計として、HomePage の位置づけとスコープを固定する。

---

**End of Document**
