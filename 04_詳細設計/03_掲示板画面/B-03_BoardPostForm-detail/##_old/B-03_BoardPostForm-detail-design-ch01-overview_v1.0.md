# B-03 BoardPostForm 詳細設計書 ch01 概要 v1.0

**Document ID:** HARMONET-COMPONENT-B03-BOARDPOSTFORM-DETAIL-CH01
**Version:** 1.0
**Supersedes:** -
**Created:** 2025-11-22
**Updated:** 2025-11-22
**Author:** Tachikoma
**Reviewer:** TKD
**Status:** Draft

---

## 1.1 文書の目的

本章は、HarmoNet 掲示板機能における **掲示板投稿画面コンポーネント BoardPostForm（B-03）** の詳細設計全体に共通する前提・目的・スコープ・関連ドキュメントを整理することを目的とする。
BoardPostForm は、URL `/board/new`（新規投稿）および将来的な `/board/[postId]/edit`（編集）に対応する入力画面として、掲示板への投稿データを作成・更新する役割を担う。

本章で定義した内容は、以降の ch02〜ch07（画面構造・データモデル・状態管理・UI・結合・テスト）に共通して適用される前提条件となる。

---

## 1.2 対象コンポーネントと役割

### 1.2.1 コンポーネント情報

* コンポーネント ID: **B-03**
* 名称: **BoardPostForm**（掲示板 投稿フォーム）
* 対応 URL（初版）:

  * 新規投稿: `/board/new`
  * 編集: `/board/[postId]/edit`（編集対応は将来拡張）
* 対象デバイス: スマートフォン優先（レスポンシブ対応）。PC ブラウザでも同一 URL を利用する。

### 1.2.2 役割

BoardPostForm の主な役割は次の通りとする。

1. 掲示板投稿に必要な入力項目（タイトル・本文・カテゴリ・対象範囲・添付ファイル等）を提供し、バリデーションを行ったうえで投稿データを作成する。
2. 管理組合ロールなど、投稿権限を持つユーザにのみ投稿フォームを表示し、一般利用者には閲覧専用（またはアクセス不可）の状態とする。
3. 添付ファイル（主に PDF）アップロード機能を提供し、Supabase Storage 等に保存されたファイル URL を `board_attachments` 等のテーブルに紐づけるための入力を生成する。
4. 必要に応じて回覧板設定（回覧対象グループ、回覧期限など）がある場合、その入力 UI を提供する（MVP の範囲は掲示板基本設計に従う）。
5. 入力エラー時には、どの項目が原因か分かる形でエラーメッセージを表示し、投稿成功時には成功メッセージおよび遷移先（BoardDetail や BoardTop）への導線を提供する。

既存投稿の編集やドラフト保存機能は将来拡張とし、初版では「新規投稿」のみを対象に詳細化する。

---

## 1.3 スコープ

### 1.3.1 本詳細設計で扱う範囲

本詳細設計（B-03 BoardPostForm）は、掲示板投稿フォームに固有の仕様を対象とし、次の内容を含む。

* `/board/new` 画面のレイアウト構造・コンポーネント構成（ch02）
* 入力 DTO（タイトル・本文・カテゴリ・範囲・添付等）、POST API のリクエスト/レスポンス仕様、バリデーション項目とエラー種別（ch03）
* 入力状態・バリデーション状態・送信中状態・送信成功/失敗状態・キャンセル操作などの状態管理とイベント遷移（ch04）
* 各入力項目のラベル・プレースホルダ・エラー文言・成功メッセージ・i18n キー定義（ch05）
* BoardTop（B-01）および BoardDetail（B-02）との遷移関係、添付アップロード API、Logger との結合関係（ch06）
* BoardPostForm 単体および軽い結合テストにおけるテスト観点（正常系／純異常系／異常系=机上）と Jest/RTL による UT 方針（ch07）

### 1.3.2 範囲外とする事項

以下は BoardPostForm 詳細設計の直接のスコープ外とし、別コンポーネントまたは共通仕様で扱う。

* BoardTop（一覧表示）および BoardDetail（詳細表示）の UI/ロジック
  → B-01 / B-02 の詳細設計書
* 添付アップロードの低レイヤ仕様（Supabase Storage バケット構成、アップロードポリシーなど）
  → 共通ファイルアップロード詳細設計書
* 翻訳/TTS の共通仕様・実装（投稿画面内で翻訳/TTS を行う想定がないため）
  → 共通翻訳/TTS 詳細設計書
* モデレーション機能（投稿の承認フローや下書き管理など）の詳細ロジック
  → 掲示板モデレーション共通仕様書、管理者画面詳細設計書
* DB スキーマ定義そのもの（テーブル・カラム・ENUM 定義など）
  → `schema.prisma`（唯一の正として参照のみ行う）

---

## 1.4 前提条件

BoardPostForm 詳細設計は、以下の前提条件のもとで成立する。

1. 認証・認可

   * HarmoNet 全体として Supabase Auth による MagicLink ログインのみを採用する。
   * BoardPostForm へのアクセスは、認証済みかつ投稿権限を持つユーザ（管理組合ロール等）に限定される。一般利用者は `/board/new` にアクセスできないか、アクセスした場合は「権限がありません」メッセージを表示する。

2. テナント・ユーザコンテキスト

   * ログイン完了時点で、現在の `tenant_id`・`user_id`・ユーザロール（管理組合 or 一般利用者）がフロントエンドから参照可能である。
   * BoardPostForm は、コンポーネント引数として `tenantId` / `userId` / `viewerRole` / `canPost` 等を受け取る前提とし、自身でロール判定ロジックを実装しない。

3. DB スキーマ

   * 掲示板投稿本体は `board_posts` に格納され、添付は `board_attachments`、回覧板関連は専用テーブル（設計済みのもの）に格納される前提とする。
   * BoardPostForm が作成するデータは、これらスキーマに完全に整合している必要がある（不整合なデータを生成しない）。

4. 入力バリデーション

   * 必須項目（タイトル・本文・カテゴリ など）はフロントエンドでバリデーションを行い、不正な入力は送信前にブロックする。
   * バリデーションルールは、基本設計および要件定義に記載された項目をベースに詳細化する（最大文字数など）。

5. UI トーン

   * UI トーンは HarmoNet 共通の「やさしい・自然・控えめ」スタイルに従い、白基調・角丸 2xl・控えめなシャドウを基本とする。
   * 入力フォームは、ログイン画面やホーム画面と同様に、過度に密度を上げず、余白を十分に確保したレイアウトとする。

---

## 1.5 関連ドキュメント

BoardPostForm 詳細設計に関連する上位文書・横断文書を以下に示す。

| 種別     | 名称                                               | 備考                                         |
| ------ | ------------------------------------------------ | ------------------------------------------ |
| 要件定義   | `functional-requirements-all_v1.6.md`            | 掲示板機能（投稿・コメント・回覧板・翻訳・TTS 等）の要件定義。          |
| 非機能要件  | `Nonfunctional-requirements_v1.0.md`             | 認証方式・性能・セキュリティ・運用方針。                       |
| 技術スタック | `harmonet-technical-stack-definition_v4.4.md`    | Next.js / Supabase / Prisma / i18n 等の技術前提。 |
| 基本設計   | `board-design-ch00-index_v2.2.md`                | 掲示板機能 基本設計 目次。                             |
| 基本設計   | `board-design-ch01_v2.2.md`                      | 掲示板機能 全体概要・用語定義。                           |
| 基本設計   | `board-design-ch05_vX.Y.md`                      | 掲示板投稿画面（BoardPostForm）基本設計。                |
| スキーマ   | `schema.prisma.txt`                              | 掲示板投稿・添付・回覧板関連テーブル定義。                      |
| 詳細設計標準 | `harmonet-detail-design-agenda-standard_v1.0.md` | 詳細設計書の章構成・記載粒度標準。                          |
| 他画面詳細  | `B-01_BoardTop-detail-design-ch00〜07`            | 投稿結果がどのように一覧に反映されるか確認するため参照。               |
| 他画面詳細  | `B-02_BoardDetail-detail-design-ch00〜07`         | 投稿結果が詳細画面でどう表示されるか確認するため参照。                |

本章で列挙した文書の内容と矛盾する仕様が見つかった場合は、上位文書（要件定義・基本設計・schema.prisma）を優先し、本詳細設計を修正する。
