# B-03 BoardPostForm 詳細設計書 ch01 概要 v1.1

**Document ID:** HARMONET-COMPONENT-B03-BOARDPOSTFORM-DETAIL-CH01
**Version:** 1.1
**Supersedes:** v1.0
**Created:** 2025-11-22
**Updated:** 2025-11-23
**Author:** Tachikoma
**Reviewer:** TKD
**Status:** Draft

---

## 1.1 文書の目的

本章は、HarmoNet 掲示板機能における **掲示板投稿画面コンポーネント BoardPostForm（B-03）** の詳細設計全体に共通する前提・目的・スコープ・関連ドキュメントを整理することを目的とする。
BoardPostForm は、URL `/board/new`（新規投稿）および `/board/[postId]/edit`（編集）に対応する入力画面として、掲示板への投稿データを作成・更新する役割を担う。

本章で定義した内容は、以降の ch02〜ch07（画面構造・データモデル・状態管理・UI・結合・テスト）に共通して適用される前提条件となる。

---

## 1.2 対象コンポーネントと役割

### 1.2.1 コンポーネント情報

* コンポーネント ID: **B-03**
* 名称: **BoardPostForm**（掲示板 投稿フォーム）
* 対応 URL:
  * 新規投稿: `/board/new`
  * 編集: `/board/[postId]/edit`（B-02 詳細画面内でのインライン編集等で利用）
* 対象デバイス: スマートフォン優先（レスポンシブ対応）。PC ブラウザでも同一 URL を利用する。

### 1.2.2 役割

BoardPostForm の主な役割は次の通りとする。

1. **投稿データの入力・検証**:
   タイトル・本文・カテゴリ・対象範囲に加え、**投稿者名の表示モード（匿名 or ニックネーム）** を必須選択項目として提供し、バリデーションを行ったうえで投稿データを作成する。
2. **アクセス制御**:
   管理組合ロールなど、投稿権限を持つユーザにのみ投稿フォームを表示する。
3. **添付ファイル管理**:
   PDF および **Office 系ファイル（Word/Excel/PowerPoint）** のアップロード機能を提供し、Storage 上の URL を投稿データに紐づける。
4. **回覧板設定**:
   必要に応じて回覧板設定（回覧対象グループ、回覧期限など）の入力 UI を提供する。
5. **モードによる振る舞いの切り替え**:
   * **新規投稿モード**: 初期値が空の状態から開始し、`POST` API を呼び出す。
   * **編集モード**: 既存の投稿データを初期値として受け取り、`PATCH` API を呼び出す。
   * エラー時には具体的な原因を表示し、成功時には適切な画面へ遷移させる。

### 1.2.3 編集権限の原則

* 編集および削除ができるのは、**自分が投稿した記事・コメントのみ**とする（`currentUserId === authorId`）。
* 管理組合ロールであっても、他人の投稿を本フォームで直接書き換えることはできない（別途モデレーション機能等の管轄とする）。

---

## 1.3 スコープ

### 1.3.1 本詳細設計で扱う範囲

本詳細設計（B-03 BoardPostForm）は、掲示板投稿フォームに固有の仕様を対象とし、次の内容を含む。

* `/board/new` および編集モード時の画面レイアウト構造・コンポーネント構成（ch02）
* 入力 DTO（タイトル・本文・カテゴリ・範囲・添付・**投稿者表示モード**等）、API のリクエスト/レスポンス仕様（ch03）
* 入力状態・バリデーション・送信中状態・**確認ダイアログ（プレビュー付き）**等の状態管理とイベント遷移（ch04）
* 各入力項目のラベル・プレースホルダ・エラー文言・成功メッセージ・i18n キー定義（ch05）
* BoardTop（B-01）および BoardDetail（B-02）との遷移・連携関係（ch06）
* BoardPostForm 単体および結合テストにおけるテスト観点（ch07）

### 1.3.2 範囲外とする事項

以下は BoardPostForm 詳細設計の直接のスコープ外とし、別コンポーネントまたは共通仕様で扱う。

* BoardTop（一覧表示）および BoardDetail（詳細表示）の UI/ロジック
  → B-01 / B-02 の詳細設計書
* 添付アップロードの低レイヤ仕様（Supabase Storage バケット構成、アップロードポリシーなど）
  → 共通ファイルアップロード詳細設計書
* 翻訳/TTS の共通仕様・実装（投稿画面内で翻訳/TTS を行う想定がないため）
  → 共通翻訳/TTS 詳細設計書 (B-04)
* モデレーション機能（投稿の承認フローや AI モデレーション設定など）
  → 掲示板モデレーション共通仕様書、管理者画面詳細設計書
* DB スキーマ定義そのもの
  → `schema.prisma`

---

## 1.4 前提条件

BoardPostForm 詳細設計は、以下の前提条件のもとで成立する。

1. 認証・認可
   * Supabase Auth による認証済みユーザのみアクセス可能。
   * 編集モード時は、アクセスユーザが「投稿の作成者本人であること」を前提とし、違反時はエラーまたは非表示とする。

2. テナント・ユーザコンテキスト
   * ログイン完了時点で、現在の `tenant_id`・`user_id`・ユーザロール・`display_name`（ニックネーム）がフロントエンドから参照可能である。
   * BoardPostForm は、コンポーネント引数として `mode`（新規/編集）や `initialData`（編集時初期値）を受け取る設計とする。

3. DB スキーマ
   * 掲示板投稿本体は `board_posts`、添付は `board_attachments` 等に格納される。
   * 本フォームで生成するデータは、スキーマ定義（`schema.prisma`）と完全に整合する。

4. 入力バリデーション
   * 必須項目（タイトル・本文・カテゴリ・**投稿者表示モード**）はフロントエンドでバリデーションを行い、不正な入力は送信前にブロックする。
   * 誤送信防止のため、送信前には必ずプレビュー付き確認ダイアログを経由する。

5. UI トーン
   * HarmoNet 共通デザイン（白基調・Apple カタログ風）に準拠する。

---

## 1.5 関連ドキュメント

BoardPostForm 詳細設計に関連する上位文書・横断文書を以下に示す。

| 種別     | 名称                                               | 備考                                         |
| ------ | ------------------------------------------------ | ------------------------------------------ |
| 要件定義   | `functional-requirements-all_v1.6.md`            | 掲示板機能（投稿・コメント・回覧板・翻訳・TTS 等）の要件定義。          |
| 非機能要件  | `Nonfunctional-requirements_v1.0.md`             | 認証方式・性能・セキュリティ・運用方針。                       |
| 技術スタック | `harmonet-technical-stack-definition_v4.4.md`    | Next.js / Supabase / Prisma / i18n 等の技術前提。 |
| 基本設計   | `board-design-ch00-index_v2.2.md`                | 掲示板機能 基本設計 目次。                             |
| 基本設計   | `board-design-ch01_v2.2.md`                      | 掲示板機能 全体概要・用語定義。                           |
| 基本設計   | `board-design-ch05_vX.Y.md`                      | 掲示板投稿画面（BoardPostForm）基本設計。                |
| スキーマ   | `schema.prisma.txt`                              | 掲示板投稿・添付・回覧板関連テーブル定義。                      |
| 他画面詳細  | `B-02_BoardDetail-detail-design-ch00〜07`         | 編集モードの呼び出し元仕様。                            |
| 共通仕様   | `B-04_BoardTranslationAndTtsService-detail-design` | 翻訳・TTS 仕様（B-03 は翻訳トリガの元となる）。               |