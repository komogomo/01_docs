---

# B-02 BoardDetail 詳細設計書 ch01 概要 v1.1

**Document ID:** HARMONET-COMPONENT-B02-BOARDDETAIL-DETAIL-CH01
**Version:** 1.1
**Supersedes:** v1.0
**Created:** 2025-11-22
**Updated:** 2025-11-23
**Author:** Tachikoma
**Reviewer:** TKD
**Status:** Draft

---

## 1.1 文書の目的

本章は、HarmoNet 掲示板機能における **掲示板詳細画面コンポーネント BoardDetail（B-02）** の詳細設計全体に共通する前提・目的・スコープ・関連ドキュメントを整理することを目的とする。
BoardDetail は、URL `/board/[postId]` に対応する画面として、BoardTop（B-01）で選択された 1 件の掲示板投稿を詳細に表示し、本文・添付ファイル・翻訳結果・音声読み上げ・コメント等を提供する。

本章で定義した内容は、以降の ch02〜ch07（画面構造・データモデル・状態管理・UI・結合・テスト）に共通して適用される前提条件となる。
また、本詳細設計は **B-03 BoardPostForm 詳細設計 v1.1 系列を正とし、投稿・編集・回覧板関連の仕様において B-03 と整合すること** を前提とする。

---

## 1.2 対象コンポーネントと役割

### 1.2.1 コンポーネント情報

* コンポーネント ID: **B-02**
* 名称: **BoardDetail**（掲示板 詳細画面）
* 対応 URL: `/board/[postId]`
* 対象デバイス: スマートフォン優先（レスポンシブ対応）。PC ブラウザでも同一 URL を利用する。

### 1.2.2 役割

BoardDetail の主な役割は次の通りとする。

1. BoardTop から選択された 1 件の投稿を、本文フルテキスト・メタ情報・添付情報とともに表示する。
2. PDF などの添付ファイルがある場合、添付一覧を表示し、モーダルプレビュー起動の入口を提供する
   （PDF プレビュー仕様は掲示板共通仕様に従う）。
3. 翻訳機能（Google Translate）と音声読み上げ機能（Google Cloud TTS）を呼び出す UI を提供し、翻訳済みテキストおよび TTS 再生の状態を表示する
   （共通翻訳/TTS コンポーネントとの結合）。
4. コメント機能が有効な場合、コメント一覧の表示およびコメント投稿 UI を提供する
   （MVP の範囲は掲示板基本設計・B-03 詳細設計および設計決定サマリに従う）。
5. エラー・権限不足・非公開状態などのケースで、利用者に分かりやすいメッセージを表示し、BoardTop などへの戻り導線を提供する。
6. 投稿の編集・削除・回覧板承認など、**投稿編集系のアクションを B-03 BoardPostForm に委譲するための入口を提供する**。
   具体的には、BoardDetail 上の「編集」等の操作から B-03 を呼び出し、編集完了後に再び BoardDetail を表示するフローを前提とする。

翻訳・TTS・モデレーションロジック・PDF プレビューの内部実装は共通部品で扱い、BoardDetail 側ではそれらを組み合わせる「画面レベルのオーケストレーション」に専念する。
投稿データの生成・更新に関する詳細なバリデーションやフォームロジックは B-03 BoardPostForm の責務とし、本コンポーネントは「閲覧とアクションの入口」にフォーカスする。

---

## 1.3 スコープ

### 1.3.1 本詳細設計で扱う範囲

本詳細設計（B-02 BoardDetail）は、掲示板詳細画面に固有の仕様を対象とし、次の内容を含む。

* `/board/[postId]` 画面のレイアウト構造・コンポーネント構成（ch02）
* 単一投稿の取得・コメント一覧取得・添付・翻訳/TTS キャッシュなどに関するデータモデルと入出力仕様（ch03）
* 投稿本文・翻訳エリア・TTS 状態・PDF プレビューモーダル・コメント UI を含む状態管理とイベント遷移（ch04）
* 本文・メタ情報・添付一覧・翻訳/TTS ボタン・コメント一覧/入力欄といった UI 詳細仕様、およびメッセージ/i18n キー定義（ch05）
* BoardTop / BoardPostForm（B-03）/ 共通翻訳/TTS / Logger との結合関係・役割分担（ch06）
* BoardDetail 単体および軽い結合テストにおけるテスト観点（正常系／純異常系／異常系=机上）と Jest/RTL による UT 方針（ch07）

特に、以下の点については **B-03 の仕様に従う**。

* 投稿の表示名モード（匿名／ニックネームなど）と表示ルール
* 投稿者ロール（管理組合・一般利用者など）に応じた操作可否
* 回覧板関連の状態（承認待ち／回覧完了 等）が UI にどう反映されるか

### 1.3.2 範囲外とする事項

以下は BoardDetail 詳細設計の直接のスコープ外とし、別コンポーネントまたは共通仕様で扱う。

* 帖一覧画面（BoardTop）および投稿フォーム（BoardPostForm）の UI/ロジック
  → B-01 / B-03 の詳細設計書
* 翻訳・TTS 共通処理の低レイヤ仕様（API キー管理・レート制御・結果キャッシュ戦略など）
  → 共通翻訳/TTS 詳細設計書、技術スタック定義書
* PDF プレビューモーダルの共通仕様（モーダルレイアウト、閉じる挙動の共通ルール）
  → 掲示板共通 PDF プレビュー仕様／共通モーダル設計書
* モデレーション機能（通報・非表示・凍結など）の詳細ロジック、管理者画面からの制御
  → 掲示板モデレーション共通仕様書、管理者画面詳細設計書
* DB スキーマ定義そのもの（テーブル・カラム・ENUM 定義など）
  → `schema.prisma`（唯一の正として参照のみ行う）

---

## 1.4 前提条件

BoardDetail 詳細設計は、以下の前提条件のもとで成立する。

1. 認証・認可

   * HarmoNet 全体として Supabase Auth による MagicLink ログインのみを採用する。
   * BoardDetail へのアクセスは、認証済みかつ有効な Supabase セッションを持つユーザに限定される。
   * 投稿へのアクセス権限（テナント・グループ・ロールによる制御）は、RLS およびバックエンドロジックで担保される前提とし、BoardDetail は「許可された投稿のみ取得される」前提で実装する。

2. テナント・ユーザコンテキスト

   * ログイン完了時点で、現在の `tenant_id`・`user_id`・ユーザロール（管理組合 or 一般利用者）がフロントエンドから参照可能である。
   * BoardDetail は、コンポーネント引数として `tenantId` / `userId` / `viewerRole` / `canPost` 等を受け取る前提とし、自身でロール判定ロジックを実装しない。
   * **投稿の表示名・ロールに関する詳細なルール（例: 匿名モード時の表示形式）は、B-03 BoardPostForm 詳細設計で定義された仕様に従う。**

3. DB スキーマ

   * 掲示板投稿本体は `board_posts` に格納され、コメントは `board_comments`、添付は `board_attachments`、翻訳/TTS キャッシュは専用テーブル（設計済みのもの）に格納される前提とする。
   * BoardDetail が利用するカラム・ENUM 値は、すべて `schema.prisma` に従い、スキーマと矛盾する仕様を本詳細設計に記載しない。

4. 翻訳・TTS の扱い

   * 翻訳・TTS の呼び出し・キャッシュ・エラー処理は共通コンポーネントまたはフックで実装される。
   * BoardDetail は、翻訳/TTS トリガーボタンおよび結果表示領域を提供し、ステータス（翻訳中・再生中・エラー等）を UI に反映する責務を持つ。

5. UI トーン

   * UI トーンは HarmoNet 共通の「やさしい・自然・控えめ」スタイルに従い、白基調・角丸 2xl・控えめなシャドウを基本とする。
   * BoardTop と整合したカード/セクション構成とし、本文・コメント部分は読みやすさを優先して余白を十分に確保する。

---

## 1.5 関連ドキュメント

BoardDetail 詳細設計に関連する上位文書・横断文書を以下に示す。

| 種別     | 名称                                                 | 備考                                         |
| ------ | -------------------------------------------------- | ------------------------------------------ |
| 要件定義   | `functional-requirements-all_v1.6.md`              | 掲示板機能（投稿・コメント・回覧板・翻訳・TTS 等）の要件定義。          |
| 非機能要件  | `Nonfunctional-requirements_v1.0.md`               | 認証方式・性能・セキュリティ・運用方針。                       |
| 技術スタック | `harmonet-technical-stack-definition_v4.4.md`      | Next.js / Supabase / Prisma / i18n 等の技術前提。 |
| 基本設計   | `board-design-ch00-index_v2.2.md`                  | 掲示板機能 基本設計 目次。                             |
| 基本設計   | `board-design-ch01_v2.2.md`                        | 掲示板機能 全体概要・用語定義。                           |
| 基本設計   | `board-design-ch04_vX.Y.md`                        | 掲示板詳細画面（BoardDetail）基本設計。                  |
| スキーマ   | `schema.prisma.txt`                                | 掲示板投稿・コメント・添付・翻訳/TTS キャッシュ定義。              |
| 詳細設計標準 | `harmonet-detail-design-agenda-standard_v1.0.md`   | 詳細設計書の章構成・記載粒度標準。                          |
| 他画面詳細  | `B-01_BoardTop-detail-design-ch00〜07`              | BoardTop との遷移・整合を確認するため参照。                 |
| 他画面詳細  | `B-03_BoardPostForm-detail-design-ch01〜07_v1.1` 系列 | 投稿・編集・回覧板・表示名ルールなど、BoardDetail が従うべき正準仕様。  |

本章で列挙した文書の内容と矛盾する仕様が見つかった場合は、上位文書（要件定義・基本設計・schema.prisma および B-03 詳細設計）を優先し、本詳細設計を修正する。

---
