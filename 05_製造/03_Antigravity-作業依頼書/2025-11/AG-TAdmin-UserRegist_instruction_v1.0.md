# AG 作業指示書：テナント管理者用ユーザ登録画面実装

## 1. 対象と目的

* 対象画面

  * テナント管理者用ユーザ登録・一覧画面：`/t-admin/users`
* 対象設計書

  * `01_t-admin-user-regist_detail_ch01_v1.0.md`（テナント管理者用ユーザ登録画面 詳細設計）
* 関連設計書

  * `HomePage-detail-design-ch01_v1.0.md`（HOME 画面 詳細設計：カード構成・遷移仕様）
* 目的

  * 上記設計書に記載された **画面仕様・入出力・ロジック・API・メッセージ・テスト観点** を満たすように、既存コードを実装・修正する。
  * HOME 画面に「テナント管理」カードを追加し、`tenant_admin` ロールを持つユーザのみが `/t-admin/users` へ遷移できるようにする。
  * **仕様変更は禁止** とし、設計書に書かれている挙動を忠実に実現する。

## 2. 前提・禁止事項

...

* ヘッダー / フッター / グローバルナビは、既存アプリの実装をそのまま使用し、**改変しない**。
* 本タスクで `/t-admin/users` 側として触ってよいのは、ログイン後レイアウトの「右側コンテンツ領域」のみとする。
* `01_t-admin-user-regist_detail_ch01_v1.0.md` の **レイアウト定義（2章）** に従い、以下を構成すること。

  * 左：`/t-admin` 共通メニュー（既存 or 今後共通化される想定の枠を使用）
  * 右：本画面コンテンツ（SEC-01〜03 の構成）

    * SEC-01: ヘッダ（タイトル・現在テナント名）
    * SEC-02: ユーザ登録フォーム
    * SEC-03: ユーザ一覧テーブル

### 3.2 カード枠・ボタンのスタイル

* カード枠を使用する場合:

  * **枠線の色・太さは AppFooter のアイコン枠と同一** にすること。
  * 本画面固有の独自色・独自太さの枠線を導入しないこと。
* ボタンについて:

  * 通常時の色
  * アクティブ時（押下・選択状態）の色
    は、**AppFooter のアイコンと同一ルール** に合わせること。
* Tailwind クラスの指定は、既存画面（掲示板TOP 等）で採用されているクラス構成に合わせ、
  本画面だけ独自の見た目・トーンにならないようにすること。

### 3.3 ロジック / API（ユーザ登録・削除）

* `01_t-admin-user-regist_detail_ch01_v1.0.md` の 1.3（機能範囲）および ロジック章に従い、次を実装すること。

  * ユーザ登録

    * メールアドレス／氏名／ふりがな／ニックネーム／グループID／住居番号／ロール／言語 の登録

      * グループID → `public.users.group_code`
      * 住居番号   → `public.users.residence_code`
      * 氏名       → `public.users.full_name`
      * ふりがな   → `public.users.full_name_kana`（任意）
      * ニックネーム → `public.users.display_name`
      * 言語       → `public.users.language`
    * `auth.users` への登録（MagicLink 用）
    * `users` / `user_tenants` / `user_roles` / `tenant_residents` への登録
  * ユーザ削除

    * 本画面からの削除操作により、**削除対象ユーザIDに紐づく当該テナント分のデータをすべて削除**する。
    * 削除対象テーブル：

      * `auth.users`
      * `users`
      * `user_tenants`
      * `user_roles`
      * `tenant_residents`（当該テナント分）
* 使用する API / モデル は、設計書に記載されているものに限定し、**新規 API エンドポイントや新規モデルの追加は禁止**。
* グループID／住居番号に関する DB 参照は、**`public.users` テーブルのみを対象**とし、新しいグループ定義テーブルや別カラムの追加・参照は行わないこと。

### 3.4 バリデーション / メッセージ

* バリデーション条件・エラーメッセージ・成功メッセージは、`01_t-admin-user-regist_detail_ch01_v1.0.md` に記載された文言・挙動に合わせること。
* 特に成功メッセージは、設計書 5.1 の以下を前提とする。

...

### 5.1 テスト前提

* メールアドレス `admin@gmail.com` に対して、対象テナント向けに `tenant_admin` ロールが付与されていること。
* `/t-admin/users` 画面の動作確認、および HOME 画面の「テナント管理」カード表示確認は、
  すべて `admin@gmail.com` でログインして実施する。
* 既存運用ユーザは削除対象にしない。
  本テストでは、以下のテスト用ユーザのみを削除対象とする。

  * 本テナント専用テストユーザ: `test-delete-1@example.com`

### 5.2 HOME からの遷移確認

1. `admin@gmail.com` でログインする。

   * HOME に「テナント管理」カードが表示されていること。
2. 「テナント管理」カードをタップ（クリック）する。

   * `/t-admin/users` に遷移し、テナント管理者用ユーザ登録・一覧画面が表示されること。

...
