# セキュレアシティ スマートコミュニケーションアプリ
## 開発ガイドライン - コーディング規約とデザイン原則

**文書バージョン:** 1.1  
**作成日:** 2025年10月24日  
**最終更新日:** 2025年10月24日  
**対象:** 開発チーム全員、AI支援開発  

---

## 目次

1. [基本方針](#1-基本方針)
   - [1.0 ファイル先頭コメント【必須】](#10-ファイル先頭コメント必須)
   - [1.1 最優先事項](#11-最優先事項)
   - [1.2 開発哲学](#12-開発哲学)
   - [1.3 3クリックルール](#13-3クリックルール)
2. [HTML コーディング規約](#2-html-コーディング規約)
3. [CSS コーディング規約](#3-css-コーディング規約)
4. [JavaScript コーディング規約](#4-javascript-コーディング規約)
5. [デザイン原則](#5-デザイン原則)
6. [掲示板機能の仕様](#6-掲示板機能の仕様)
7. [禁止事項](#7-禁止事項)
8. [推奨ツールと環境](#8-推奨ツールと環境)

---

## 1. 基本方針

### 1.0 ファイル先頭コメント【必須】

**すべてのコードファイルの先頭行には、以下の情報を必ず記載してください。**

#### HTMLファイルの場合

```html
<!--
  設置パス: /index.html
  画面名: ログイン画面
-->
<!DOCTYPE html>
<html lang="ja">
...
```

#### CSS/JavaScriptファイルの場合

```css
/**
 * 設置パス: /css/variables.css
 * ファイル名: CSS変数定義
 * 
 * [ファイルの説明]
 * すべての色、サイズ、スペーシングをここで一元管理
 */
```

```javascript
/**
 * 設置パス: /js/main.js
 * ファイル名: メインロジック
 * 画面名: ログイン画面（該当する場合）
 * 
 * [ファイルの説明]
 * ログイン画面の処理
 */
```

#### 記載する情報

1. **設置パス**: プロジェクトルートからの相対パス（例: `/index.html`, `/js/main.js`）
2. **ファイル名/画面名**: ファイルの役割や画面名
3. **説明**: ファイルの目的や機能の概要（簡潔に）

#### 目的

- ファイルの所在と役割を即座に把握できる
- 複数人での開発時に混乱を防ぐ
- AI支援開発時にコンテキストを明確にする

---

### 1.1 最優先事項

このプロジェクトでは、以下の3つを最優先とする：

1. **保守性** - 修正しやすいコード
2. **可読性** - 理解しやすいコード
3. **動作保証** - 確実に動くコード

**デザインの美しさより、デバッグのしやすさを優先する。**

### 1.2 開発哲学

```
複雑なコードで完璧なデザイン　　✗ 避ける
シンプルなコードで十分なデザイン ✓ 推奨
```

### 1.3 3クリックルール

すべてのコードは以下のルールを守る：

- 1つのHTMLファイル：**300行以内**
- 1つのCSSクラス：**10プロパティ以内**
- 1つのJavaScript関数：**30行以内**

これを超える場合は、分割を検討する。

---

## 2. HTML コーディング規約

### 2.1 基本構造

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ページタイトル</title>
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>
    <!-- ヘッダー -->
    <header class="page-header">
        <!-- ヘッダーコンテンツ -->
    </header>

    <!-- メインコンテンツ -->
    <main class="page-main">
        <!-- ページ固有のコンテンツ -->
    </main>

    <!-- フッター（必要な場合のみ） -->
    <footer class="page-footer">
        <!-- フッターコンテンツ -->
    </footer>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
</body>
</html>
```

### 2.2 セマンティックHTML

意味のあるタグを使用する：

```html
<!-- ✓ 良い例 -->
<header>ヘッダー</header>
<nav>ナビゲーション</nav>
<main>メインコンテンツ</main>
<section>セクション</section>
<article>記事</article>
<aside>サイドバー</aside>
<footer>フッター</footer>

<!-- ✗ 悪い例 -->
<div class="header">ヘッダー</div>
<div class="nav">ナビゲーション</div>
<div class="main">メインコンテンツ</div>
```

### 2.3 クラス命名規則（BEM記法）

```html
<!-- Block（ブロック） -->
<div class="post-card">
    <!-- Element（要素） -->
    <div class="post-card__header">
        <span class="post-card__category">運営</span>
        <span class="post-card__date">2025/10/24</span>
    </div>
    <h3 class="post-card__title">タイトル</h3>
    <p class="post-card__content">本文</p>
    
    <!-- Modifier（修飾子） -->
    <button class="post-card__button post-card__button--primary">
        確認
    </button>
</div>
```

**命名ルール：**
- Block: `block-name`（ハイフン区切り）
- Element: `block-name__element-name`（アンダースコア2つ）
- Modifier: `block-name--modifier-name`（ハイフン2つ）

### 2.4 data属性の活用

JavaScript からの操作用には `data-*` 属性を使用：

```html
<div class="post-card" data-category="official" data-post-id="12345">
    <!-- コンテンツ -->
</div>
```

### 2.5 アクセシビリティ

```html
<!-- ボタンには適切なラベル -->
<button aria-label="戻る">←</button>

<!-- 画像には代替テキスト -->
<img src="image.jpg" alt="駐車場のマップ">

<!-- フォーム要素にはlabelを -->
<label for="email">メールアドレス</label>
<input type="email" id="email" name="email">
```

---

## 3. CSS コーディング規約

### 3.1 CSS変数の定義

すべての色、サイズ、スペーシングはCSS変数で管理：

```css
:root {
    /* カラーパレット */
    --primary-color: #6366f1;
    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    
    /* 背景色 */
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
    --bg-tertiary: #e5e5e5;
    
    /* テキスト色 */
    --text-primary: #333333;
    --text-secondary: #666666;
    --text-tertiary: #999999;
    
    /* ボーダー */
    --border-color: #e0e0e0;
    --border-radius: 8px;
    
    /* シャドウ（1種類のみ） */
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    
    /* スペーシング */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;
    
    /* フォントサイズ */
    --font-xs: 12px;
    --font-sm: 14px;
    --font-md: 16px;
    --font-lg: 18px;
    --font-xl: 24px;
}
```

### 3.2 基本スタイルの例

```css
/* ページ全体 */
.page {
    max-width: 600px;
    margin: 0 auto;
    padding: var(--space-md);
    background: var(--bg-secondary);
}

/* カード */
.card {
    background: var(--bg-primary);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    padding: var(--space-md);
    margin-bottom: var(--space-md);
}

/* ボタン */
.button {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    padding: var(--space-sm) var(--space-lg);
    font-size: var(--font-md);
    cursor: pointer;
    transition: opacity 0.2s;
}

.button:hover {
    opacity: 0.8;
}

.button:active {
    opacity: 0.6;
}
```

### 3.3 レスポンシブデザイン（2段階のみ）

```css
/* スマートフォン（デフォルト） */
.container {
    padding: var(--space-md);
}

/* PC・タブレット（768px以上） */
@media (min-width: 768px) {
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: var(--space-xl);
    }
}
```

### 3.4 禁止事項

```css
/* ✗ 絶対に使用禁止 */
.bad-example {
    color: red !important;  /* !important 禁止 */
}

/* ✗ 非推奨（複雑すぎる） */
.complex-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
}

/* ✓ 推奨（シンプル） */
.simple-background {
    background: var(--primary-color);
}
```

### 3.5 1クラス10プロパティ制限

```css
/* ✓ 良い例（9プロパティ） */
.post-card {
    background: var(--bg-primary);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    padding: var(--space-md);
    margin-bottom: var(--space-md);
    cursor: pointer;
    transition: transform 0.2s;
}

.post-card:hover {
    transform: translateY(-2px);
}

/* ✗ 悪い例（多すぎる） */
.bad-card {
    /* 15個のプロパティ... */
    /* 分割すべき */
}
```

---

## 4. JavaScript コーディング規約

### 4.1 基本原則

- グローバル変数は最小限
- 1関数30行以内
- コメントは「なぜ」を書く（「何を」は不要）

### 4.2 関数の書き方

```javascript
/**
 * カテゴリでフィルタリングする
 * 
 * @param {string} category - カテゴリ名（'all', 'official', 'event'など）
 * 
 * 理由：ユーザーが特定のカテゴリの投稿のみを見たい場合がある
 */
function filterByCategory(category) {
    const posts = document.querySelectorAll('.post-card');
    
    posts.forEach(post => {
        const postCategory = post.dataset.category;
        
        // 'all' の場合はすべて表示、それ以外は一致するもののみ表示
        if (category === 'all' || postCategory === category) {
            post.style.display = 'block';
        } else {
            post.style.display = 'none';
        }
    });
}

// イベントリスナーの設定
document.getElementById('categoryFilter').addEventListener('change', function(e) {
    filterByCategory(e.target.value);
});
```

### 4.3 変数命名規則

```javascript
// ✓ 良い例（意味が明確）
const userName = '田中太郎';
const postList = document.querySelectorAll('.post-card');
const isLoggedIn = true;
const MAX_POSTS = 100;  // 定数は大文字

// ✗ 悪い例（意味不明）
const x = '田中太郎';
const arr = document.querySelectorAll('.post-card');
const flg = true;
```

### 4.4 エラーハンドリング

```javascript
/**
 * APIからデータを取得する
 */
async function fetchPosts() {
    try {
        const response = await fetch('/api/posts');
        
        if (!response.ok) {
            throw new Error(`HTTPエラー: ${response.status}`);
        }
        
        const data = await response.json();
        return data;
        
    } catch (error) {
        console.error('投稿の取得に失敗:', error);
        alert('データの読み込みに失敗しました。再度お試しください。');
        return [];
    }
}
```

### 4.5 デバッグ用のログ

```javascript
// 開発時のみ有効なログ
const DEBUG = true;  // 本番環境では false にする

function debugLog(message, data) {
    if (DEBUG) {
        console.log(`[DEBUG] ${message}`, data);
    }
}

// 使用例
debugLog('投稿一覧を取得', posts);
```

---

## 5. デザイン原則

### 5.1 シンプルさの追求

**削減すべき要素：**
- ✂️ 複雑なグラデーション → 単色
- ✂️ 過度なアニメーション → 必要最小限
- ✂️ 多層的なシャドウ → 1種類のみ
- ✂️ カスタムフォント → システムフォント

**保持すべき要素：**
- ✅ 色による視認性（カテゴリバッジなど）
- ✅ 適度な余白とカード型レイアウト
- ✅ レスポンシブ対応（2段階）

### 5.2 カラーガイドライン

#### 基本色の使い分け

| 色 | 用途 | 変数名 |
|----|------|--------|
| **プライマリー** (#6366f1) | メインボタン、リンク | `--primary-color` |
| **セカンダリー** (#8b5cf6) | サブボタン、強調 | `--secondary-color` |
| **成功** (#10b981) | 完了メッセージ、成功表示 | `--success-color` |
| **警告** (#f59e0b) | 注意喚起 | `--warning-color` |
| **エラー** (#ef4444) | エラーメッセージ | `--danger-color` |

#### カテゴリ色の定義

```css
/* カテゴリバッジの色 */
.category-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: var(--font-xs);
    font-weight: bold;
}

.category-official {
    background: #fee;
    color: #c00;
}

.category-event {
    background: #eff6ff;
    color: #2563eb;
}

.category-trade {
    background: #f0fdf4;
    color: #16a34a;
}

.category-parenting {
    background: #fef3c7;
    color: #d97706;
}

.category-general {
    background: #f3f4f6;
    color: #6b7280;
}
```

### 5.3 スペーシングの原則

```
4の倍数でスペーシングを統一：
- 4px  (--space-xs)  : アイコンとテキストの間隔
- 8px  (--space-sm)  : 小さな余白
- 16px (--space-md)  : 標準的な余白
- 24px (--space-lg)  : 大きな余白
- 32px (--space-xl)  : セクション間の余白
```

### 5.4 タイポグラフィ

```css
/* フォントファミリー（システムフォント） */
body {
    font-family: 
        -apple-system,           /* macOS/iOS */
        BlinkMacSystemFont,      /* macOS/iOS */
        "Segoe UI",              /* Windows */
        "Noto Sans JP",          /* 日本語 */
        sans-serif;
}

/* フォントサイズの使い分け */
h1 { font-size: var(--font-xl); }  /* 24px - ページタイトル */
h2 { font-size: var(--font-lg); }  /* 18px - セクションタイトル */
h3 { font-size: var(--font-md); }  /* 16px - カードタイトル */
p  { font-size: var(--font-md); }  /* 16px - 本文 */
small { font-size: var(--font-sm); }  /* 14px - 補足情報 */
```

---

## 6. 掲示板機能の仕様

### 6.1 カテゴリ定義

| カテゴリ名 | 英語 | 中国語 | 投稿権限 | 用途 |
|-----------|------|--------|---------|------|
| 運営からのお知らせ | Official Notice | 官方通知 | 管理者のみ | 自治会からの公式連絡 |
| イベント | Events | 活动 | 全員 | イベント告知 |
| 売買・譲渡 | Trade | 交易 | 全員 | 不用品譲渡 |
| 子育て・教育 | Parenting | 育儿 | 全員 | 子育て情報交換 |
| その他・雑談 | General | 其他 | 全員 | 一般的な話題 |

### 6.2 データベース定義

```typescript
// bbs_threads テーブル
interface BbsThread {
    id: string;
    tenant_id: string;
    category: 'official' | 'event' | 'trade' | 'parenting' | 'general';
    title: string;
    content: string;
    author_id: string;
    created_at: Date;
    updated_at: Date;
}
```

### 6.3 プルダウンフィルタの実装

```html
<!-- 掲示板一覧画面 -->
<div class="filter-section">
    <label for="categoryFilter">カテゴリ:</label>
    <select id="categoryFilter" class="select-input">
        <option value="all">全て表示</option>
        <option value="official">運営からのお知らせ</option>
        <option value="event">イベント</option>
        <option value="trade">売買・譲渡</option>
        <option value="parenting">子育て・教育</option>
        <option value="general">その他・雑談</option>
    </select>
</div>
```

```javascript
// フィルタリング機能
document.getElementById('categoryFilter').addEventListener('change', function(e) {
    const selectedCategory = e.target.value;
    const posts = document.querySelectorAll('.post-card');
    
    posts.forEach(post => {
        const postCategory = post.dataset.category;
        
        if (selectedCategory === 'all' || postCategory === selectedCategory) {
            post.style.display = 'block';
        } else {
            post.style.display = 'none';
        }
    });
});
```

---

## 7. 禁止事項

### 7.1 絶対に使用してはいけないもの

```css
/* ✗ !important 禁止 */
.bad {
    color: red !important;
}
```

```javascript
// ✗ eval() 禁止（セキュリティリスク）
eval('alert("danger")');

// ✗ グローバル変数の乱用
var globalVariable = 'bad';
```

### 7.2 推奨しないもの

```css
/* ✗ 複雑なグラデーション */
background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);

/* ✗ 過度なアニメーション */
@keyframes complexAnimation {
    /* 10行以上のキーフレーム */
}

/* ✗ 多層シャドウ */
box-shadow: 
    0 1px 3px rgba(0,0,0,0.12),
    0 1px 2px rgba(0,0,0,0.24),
    0 10px 20px rgba(0,0,0,0.19);
```

### 7.3 コメントアウトの禁止

```javascript
// ✗ 悪い例：使わないコードをコメントアウトして残す
// function oldFunction() {
//     // 古いコード
// }

// ✓ 良い例：不要なコードは削除する（Gitで履歴管理）
```

---

## 8. 推奨ツールと環境

### 8.1 開発環境

- **エディタ**: Visual Studio Code
- **OS**: WSL2 + Ubuntu 22.04 LTS (Windows) / macOS / Linux
- **Node.js**: LTS版（22.20.0）

### 8.2 VS Code 推奨拡張機能

```json
{
    "recommendations": [
        "dbaeumer.vscode-eslint",           // JavaScript リンター
        "esbenp.prettier-vscode",           // コードフォーマッター
        "bradlc.vscode-tailwindcss",        // CSS補完
        "formulahendry.auto-rename-tag",    // HTMLタグ自動リネーム
        "ms-vscode.live-server"             // ライブリロード
    ]
}
```

### 8.3 コードフォーマット設定

```json
// .prettierrc
{
    "semi": true,
    "singleQuote": true,
    "tabWidth": 4,
    "trailingComma": "es5",
    "printWidth": 100,
    "arrowParens": "avoid"
}
```

---

## 9. チェックリスト

### 9.1 コミット前のチェック

- [ ] HTMLファイルは300行以内か？
- [ ] CSSクラスは10プロパティ以内か？
- [ ] JavaScript関数は30行以内か？
- [ ] `!important` を使用していないか？
- [ ] グローバル変数を最小限にしているか？
- [ ] コメントアウトしたコードを削除したか？
- [ ] CSS変数を使用しているか？
- [ ] セマンティックHTMLを使用しているか？

### 9.2 レビュー時のチェック

- [ ] コードは読みやすいか？
- [ ] 修正しやすい構造か？
- [ ] デバッグしやすいか？
- [ ] 必要最小限の機能か？（過剰な機能追加をしていないか）

---

## 10. 参考資料

### 10.1 命名規則

- BEM記法: http://getbem.com/
- JavaScript命名規則: https://github.com/airbnb/javascript

### 10.2 アクセシビリティ

- WCAG 2.1: https://www.w3.org/WAI/WCAG21/quickref/

---

**文書管理番号:** SEC-APP-GUIDELINE-001  
**最終更新日:** 2025年10月24日  
**承認者:** ____________________  

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.1 | 2025/10/24 | 1.0「ファイル先頭コメント【必須】」ルールを追加 |
| 1.0 | 2025/10/24 | 初版作成 |
