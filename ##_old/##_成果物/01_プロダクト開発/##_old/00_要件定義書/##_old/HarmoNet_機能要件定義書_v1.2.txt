# HarmoNet 機能要件定義書 v1.2（Part1-1）
文書バージョン: 1.2
作成日: 2025年10月30日
最終更新日: 2025年10月30日
プロジェクト名: HarmoNet（ハーモネット）

---

## 第1章 ドキュメント概要

### 1.1 目的
本書は、HarmoNetアプリケーションの開発における機能および非機能要件を定義し、システム開発・運用・AI協調開発体制に関する共通理解を確立することを目的とする。

### 1.2 適用範囲
本書は、HarmoNetアプリケーションの全体構成および主要機能の要件定義を対象とし、関連するバックエンド・フロントエンド・インフラ・UI層を含む。

### 1.3 背景と開発体制
HarmoNetは、地域住民・管理組合・住宅デベロッパー間の情報共有と共助を支援するために構築される。
開発体制はAI協調型であり、以下の3AIが役割分担して開発を行う。

| AI | 主担当領域 |
|----|-------------|
| Claude | 画面設計・UXデザイン・構造化ドキュメント |
| Gemini | 開発環境構築・インフラ・CI/CD・デバッグ支援 |
| GPT（タチコマ） | PMO支援・コード生成・要件定義書/設計書統合・レビュワー |

開発はMVP方式を採用し、3.2人月での初期実装を目指す。MVP後はフェーズ型で機能拡張を行い、将来的なマルチテナント対応・AI拡張を前提とする。

---

## 第2章 システム概要

### 2.1 開発目的
HarmoNetは以下の目的を達成するために開発される：
1. 情報伝達の確実化：管理組合からのお知らせ・回覧板のデジタル化と多言語対応
2. 共用施設の効率利用：駐車場・集会所等のオンライン予約
3. コミュニティ活性化：掲示板・イベント・双方向コミュニケーション促進
4. 管理業務の効率化：情報発信の一元化、既読状況の可視化
5. 国際化対応：日本語・英語・中国語（簡体字）の3言語対応

### 2.2 利用対象者
- 一般住民（日本語話者、外国語話者、高齢者層を含む）
- 管理者（管理組合理事、管理会社担当者）
- 将来的にはデベロッパー担当者・自治体担当者も想定

### 2.3 システム全体像
技術スタック（MVP時点）:

| レイヤー | 技術 | 備考 |
|-----------|------|------|
| バックエンド | NestJS (Node.js) | APIサーバー |
| ORM | Prisma ORM | DBスキーマ管理・型安全 |
| データベース | PostgreSQL | Supabaseを想定 |
| キャッシュ | Redis | 翻訳・セッションキャッシュ |
| フロントエンド | React + PWA | スマホ／PC対応、React Nativeは将来検討 |
| スタイリング | Tailwind CSS | Appleカタログ風・BIZ UDゴシック準拠 |
| コンテナ | Docker | 開発環境統一 |
| 通知 | Firebase Cloud Messaging | iOS/Android対応 |
| メール配信 | SendGrid or Amazon SES | 通知メール |
| 翻訳API | Google Cloud Translation API | 多言語変換 |
| デプロイ環境 | Vercel + Supabase | MVP構成 |
| 将来構成 | AWS ECS + RDS | スケーラブル構成へ移行予定 |

アーキテクチャ構造:

```
[Client Layer: React PWA]
      ↓ HTTPS / REST API
[Application Layer: NestJS + Prisma]
      ↓
[Data Layer: PostgreSQL + Redis]
      ↓
[External Services: Translation, FCM, SES]
```

### 2.4 運用前提
- 対応デバイス: スマートフォン（iOS/Android）、タブレット、PC
- 対応ブラウザ: Chrome、Safari、Edge、Firefox（最新版）
- 運用時間: 24時間365日（メンテナンス時除く）
- 稼働率目標: 99%以上

---

# HarmoNet 機能要件定義書 v1.2（Part1-2）
文書バージョン: 1.2
作成日: 2025年10月30日
最終更新日: 2025年10月30日

---

## 第3章 機能要件

本章では、HarmoNetにおける全機能を定義する。
MVP（最小実装）と将来実装を明確に区分する。

---

### 3.1 ホーム画面
対象: MVP

#### 3.1.1 概要
ログイン後に表示されるポータル画面であり、各機能へのナビゲーション中枢を担う。

#### 3.1.2 基本レイアウト
1. ヘッダーエリア
– アプリ名（HarmoNet）
– 通知アイコン（未読件数バッジ付き）
– 言語切替ボタン（JA / EN / CN）

2. ウェルカムエリア
– ログイン中ユーザー名
– 所属テナント名（例：「A棟-105号室」）

3. 最新お知らせエリア
– 最新3件のお知らせ
– 未読／既読状態表示
– 「一覧を見る」ボタン

4. 機能タイルエリア（3×3グリッド）
– 各主要機能へのショートカット

5. フッターエリア
– 固定ナビゲーション（デザインガイドライン参照）

#### 3.1.3 機能タイル一覧

| タイル名 | アイコン | 遷移先 | 対象 |
|-----------|-----------|--------|------|
| 駐車場予約 | 📅 | 駐車場予約TOP | ○ |
| 回覧板 | 📋 | 回覧板一覧 | ○ |
| 掲示板 | 💬 | 掲示板一覧 | ○ |
| 通知設定 | 🔔 | 通知設定 | ○ |
| 消耗品照会（将来） | 🛒 | 消耗品TOP | × |
| 監視カメラ（将来） | 📷 | カメラ参照 | × |
| 見守り（将来） | ❤️ | 安否確認 | × |

---

### 3.2 掲示板機能
対象: MVP

#### 3.2.1 概要
住民間の情報共有および管理組合からの周知事項の配信を行う双方向掲示システム。
「荒れない」「疲弊しない」を基本設計理念とし、AIモデレーションを組み込み安心感を重視する。

#### 3.2.2 掲示板の種類
- 全体掲示板: 全住民が閲覧・投稿可能
- グループ掲示板: 班・棟などグループ単位の限定閲覧・投稿
- 回覧板枠: 管理組合・理事会・管理会社からの公式発信専用（返信不可）

テナント管理者はグループ定義・掲示板カテゴリを設定できる。

#### 3.2.3 投稿機能
- 新規スレッド投稿: タイトル・本文・画像添付（最大3枚）
- 匿名またはニックネーム選択可（内部ID保持）
- 返信機能: 一段階階層（ネスト不可）

#### 3.2.4 返信制御ルール
- 投稿属性に「返信可／不可」を設定
- 「回覧板」タグ付き投稿は返信不可
- 属性は投稿種別とタグで自動制御

#### 3.2.5 AIモデレーション機能
- 投稿前にAIが本文を解析し、不適切・攻撃的・個人情報を検知
- 警告を表示し、必要に応じ自動で穏やかな表現に変換
- 投稿拒否はせず、表現の柔和化に留める

#### 3.2.6 閲覧機能
- 一覧画面: カテゴリ・タグ・コメント数・翻訳ボタン表示
- 詳細画面: 本文・画像・コメントを時系列表示
- 「翻訳」ボタンで日／英／中の切替

#### 3.2.7 編集・削除・通報
- 投稿者本人による削除可
- 管理者は全投稿削除可
- 通報機能で理由付き報告、削除ログ保持

#### 3.2.8 回覧板・重要お知らせ
- 管理者投稿は「回覧板」タグ付与、自動固定・返信不可
- 全住民に通知連携
- 既読確認・再通知（未読者リマインダー）

#### 3.2.9 既読管理機能
- 管理者が既読／未読状況確認
- ユーザーごと閲覧日時記録
- 未読者へ自動再通知
- CSV出力対応

#### 3.2.10 安心・安全性の担保
- 匿名＋AIモデレーションによる心理的安全確保
- 管理者介入を最小化
- トレーサビリティ維持

---

### 3.3 お知らせ表示
対象: MVP

#### 3.3.1 概要
管理組合から住民への一方向型情報伝達（Push配信連携）

#### 3.3.2 お知らせ一覧（住民側）
- カテゴリバッジ（重要／イベント／メンテ／回覧など）
- タイトル、投稿日、既読状態
- フィルタ・検索（カテゴリ・未読・日付・キーワード）

#### 3.3.3 お知らせ詳細
- 多言語本文・添付画像（最大5枚）
- 「確認済み」ボタンで既読管理
- 公開終了日時設定可

#### 3.3.4 作成・編集（管理者側）
- タイトル／本文（日本語入力→API翻訳→確認修正）
- 翻訳: Google Translation API（日→英・中）
- プレビュー機能で3言語確認
- 「公開」押下でDB登録＋通知送信（メール／プッシュ）

#### 3.3.5 管理画面機能
- 全お知らせの状態（公開中／予約／終了）一覧
- 編集・論理削除
- 回覧板確認率の集計・CSV出力

---

### 3.4 施設予約
対象: MVP（駐車場）／将来（集会所・他施設）

#### 3.4.1 概要
共用施設（駐車場など）のオンライン予約管理。
テナント単位で予約可能日数や連続予約可否を設定可能。

#### 3.4.2 駐車場仕様（MVP）
- 表側（F1〜F6）6台／裏側（B1〜B6）6台＝計12台
- 利用単位：1日／料金：100円（税込）
- 決済：アプリ内決済なし（後日請求）

#### 3.4.3 予約ルール
| 項目 | 内容 |
|------|------|
| 同日複数予約 | 不可 |
| 連続予約 | 最大3日（設定で制御） |
| 予約可能期間 | 当日〜30日先 |
| キャンセル | 利用前まで自由 |

#### 3.4.4 予約フロー（住民）
1. カレンダー表示（色分け: 白=可／灰=満車／緑=自分）
2. 日付選択 → 駐車場MAP表示
3. MAP上で場所選択
4. 車両ナンバー入力（任意）
5. 「予約確定」押下 → 二重チェック → 通知送信

#### 3.4.5 管理機能
- 全予約一覧・カレンダー表示
- 管理者による代理予約／キャンセル
- 特定日のブロック設定
- 利用率レポート（CSV対応、将来）

---

### 3.5 掃除当番
対象: 将来実装
- 当番表の自動生成
- 通知（前日リマインダー）
- 完了報告／編集機能

---

### 3.6 アンケート
対象: 将来実装
- 単一／複数選択・自由記述対応
- 回答期限設定
- 回答率集計／未回答リマインダー
- グラフ表示・CSV出力

---

### 3.7 マイページ
対象: MVP

#### 3.7.1 管理者機能
- お知らせ管理（作成・編集・削除）
- 既読状況確認
- ユーザー登録・編集・削除（論理削除）
- CSVインポート一括登録
- フッター／デザイン設定（外部ガイドライン参照）

#### 3.7.2 ユーザー機能
- プロフィール編集（氏名／メール／言語設定）
- 通知設定（メール・プッシュ ON/OFF）
- 掲示板投稿履歴・施設予約履歴確認
- ログアウト（確認ダイアログ付き）

---

### 3.8 共通機能

#### 3.8.1 ヘッダー表示
- 「HarmoNet」ロゴ左上配置
- 右上：通知ベル＋言語切替（JA/EN/CN）
- デザイン詳細は外部ファイル: HarmoNet_デザインガイドライン（最新版）を参照

#### 3.8.2 フッター表示
- 固定ナビゲーション
- アイコン：🏠 ホーム／🔔 お知らせ／💬 掲示板／📅 予約／👤 マイページ／🚪 ログアウト
- 現在画面は青インジケータ表示
- レイアウト詳細もデザインガイドライン参照

#### 3.8.3 多言語対応
- 静的UI：翻訳マスタ管理
- 動的投稿：Google Translation API
- キャッシュ最適化（Redis）
- 翻訳対象：お知らせ・掲示板・通知文面など
- 無料枠（50万文字/月）内運用を想定

---

### 3.9 通知機能
対象: MVP

#### 3.9.1 プッシュ通知
- 対象イベント：お知らせ公開／駐車場予約／掲示板返信
- 多言語対応：ユーザー設定に従う
- 実装：Firebase Cloud Messaging（FCM）

#### 3.9.2 メール通知
- 送信イベント：マジックリンク／予約完了／掲示板コメント
- 実装：SendGrid または Amazon SES
- 言語テンプレートは翻訳マスタで管理

---

# HarmoNet 機能要件定義書 v1.2（Part2）
文書バージョン: 1.2
作成日: 2025年10月30日
最終更新日: 2025年10月30日

---

## 第4章 非機能要件

### 4.1 セキュリティ

#### 4.1.1 認証方式
HarmoNetでは、パスワードレス認証（マジックリンク方式）を採用する。  
Keycloakなどの外部認証基盤は使用せず、NextAuthをベースとした独自実装を行う。

**メリット:**
- パスワード管理負担の軽減  
- パスワード漏洩リスクの排除  
- ユーザビリティの向上

**認証フロー:**
1. ユーザーがメールアドレスを入力し「ログインリンクを送信」  
2. メール送信後、認証用リンクが発行される（有効期限15分）  
3. リンククリックで有効性確認 → セッション発行  
4. セッションはHTTPOnly Cookie（有効期限7日）で管理  

**セキュリティ対策:**
- トークンのランダム性: UUID v4、128ビット以上  
- HTTPS通信強制（TLS1.3）  
- レートリミット: 1分あたり3回まで  
- 監査ログ: IP・UA・時刻記録  
- 強制ログアウト: 管理者が特定ユーザーを切断可能  

#### 4.1.2 暗号化方式
- 通信: HTTPS（TLS1.3）で全通信暗号化  
- データ保存: AES-256（個人情報）、SHA-256（トークン）  
- 鍵管理: Secrets ManagerまたはSupabase Secrets利用  
- 鍵ローテーション: 年1回実施  

---

### 4.2 性能要件

| 項目 | 要件 |
|------|------|
| ページ初回読み込み | 3秒以内 |
| 再訪時読み込み | 1秒以内 |
| 翻訳処理時間 | 5秒以内（500文字） |
| 同時アクセス | 200ユーザー（MVP）／500ユーザー（拡張） |
| DB応答時間 | 1秒以内（95%tile） |
| API応答時間 | 2秒以内（95%tile） |

**最適化施策:**
- 画像圧縮（WebP、遅延ロード）  
- CDNキャッシュ利用（Vercel Edge + Cloudflare CDN）  
- Redisキャッシュ（翻訳・セッション）  
- React Lazy Loading、コード分割  
- Prismaインデックス最適化  

---

### 4.3 アクセシビリティ

- 準拠基準: WCAG 2.1 AA  
- フォント: BIZ UDゴシック（UD対応）  
- コントラスト比: 4.5:1 以上  
- モバイル操作: 最小タップ領域 44×44px  
- キーボード操作: 全操作対応  
- 表示倍率: 200%まで可読  
- 言語: 日本語・英語・中国語（簡体字）  
- RTL言語は将来対応検討  

---

### 4.4 スケーラビリティ

**ユーザー規模:**  
初期: 100ユーザー（単一テナント）  
中期: 500ユーザー（複数物件）  
長期: 5,000ユーザー（デベロッパー横断）  

**戦略:**  
- 垂直スケーリング: コンテナスペック強化  
- 水平スケーリング: 複数ECS/Fargate構成  
- DBレプリカ・キャッシュ分散  
- 将来的に機能単位マイクロサービス化  

**マルチテナント対応:**  
- tenant_idによる論理分離  
- テナントごとの設定・テーマカスタマイズ  
- Supabase Row Level Security（RLS）適用  

---

## 第5章 構成管理・環境要件

### 5.1 開発環境構成

| レイヤー | 技術 | バージョン |
|-----------|------|-------------|
| バックエンド | NestJS (Node.js) | 10.x |
| ORM | Prisma ORM | 5.x |
| DB | PostgreSQL | 15.x |
| キャッシュ | Redis | 7.x |
| フロント | React + PWA | 18.x |
| スタイリング | Tailwind CSS | 3.x |
| コンテナ | Docker Desktop | 24.x |
| DBツール | pgAdmin / A5:SQL Mk-2 | 最新 |
| バージョン管理 | Git（GitHub） | - |

**ローカル構築手順:**
1. Docker Desktopインストール  
2. `git clone`  
3. `.env.local` 設定  
4. `docker-compose up -d` 起動  
5. `npm install` → `npm run dev`  
6. `npx prisma migrate dev`  
7. ブラウザで `http://localhost:3000` 起動確認  

**開発規約:**
- Airbnb JS Style Guide 準拠  
- Conventional Commits 運用  
- Git Flow ブランチ戦略採用  

---

### 5.2 ホスティング構成（MVP）

| 層 | サービス | 備考 |
|----|-----------|------|
| CDN | Vercel Edge | 静的ファイル配信 |
| API / SSR | Vercel Serverless | NestJS構成 |
| DB | Supabase PostgreSQL | 認証・RLS対応 |
| ストレージ | Supabase Storage | 画像・添付 |
| メール | SendGrid | 通知メール |
| 通知 | Firebase Cloud Messaging | プッシュ通知 |
| 監視 | UptimeRobot / Sentry | 稼働監視 / エラー管理 |

**将来構成:** AWS ECS + RDS + CloudFront にスケールアップ可能。  

---

### 5.3 バックアップ／監視設計

| 対象 | 頻度 | 保管期間 | 保管場所 |
|------|------|-----------|----------|
| DB（完全） | 日次 | 7日 | Supabase自動バックアップ |
| DB（週次） | 週次 | 4週 | Cloud Storage |
| DB（月次） | 月次 | 12ヶ月 | Glacier |
| 画像 | リアルタイム | 30日 | Supabase Versioning |

**監視項目:**  
CPU >80%、メモリ >85%、レスポンス >3s → アラート。  
通知経路: Slack / メール。  

---

## 第6章 制約条件・将来展望

### 6.1 開発スコープ制限（MVP）
1. 決済機能非対応（後日請求制）  
2. 中国語は簡体字のみ対応（繁体字は将来）  
3. 時間単位予約は非対応（1日単位のみ）  
4. マルチテナント機能は限定的（単一物件前提）  
5. Translation API無料枠依存（月50万文字）  
6. 同時接続上限: 200ユーザー（拡張で500）  

---

### 6.2 将来的な拡張（AI連携・スマート通知・住宅設備消耗品）

**フェーズ2（MVP後6ヶ月以内）**  
- 安否確認機能（災害時一斉通知／未回答者再通知）  
- 監視カメラ映像参照（共用部モニタリング）  
- **住宅設備・消耗品照会／発注機能**  
  - 住宅設備機器および共用部消耗品（フィルター・電球等）の照会  
  - 型番検索／在庫確認／発注連携（管理会社・EC連携）  
  - 注文履歴・再注文機能  
  - 管理組合側の在庫管理との統合を将来検討  
- アンケート機能（集計・グラフ化）  
- 掃除当番表自動生成／通知連携  

**フェーズ3（MVP後1年以内）**  
- HEMS連携（電力グラフ表示、ハード非依存）  
- ゴミ出しカレンダー／宅配通知／設備報告  
- オンライン決済／管理費連携  
- AI自動翻訳最適化／自動要約／異常検知  

**フェーズ4（MVP後2年以内）**  
- 本格マルチテナント化（物件横断管理）  
- IoT／スマートホーム連携（ロック・センサー）  
- コミュニティ機能拡充（イベント募集・物品貸借）  
- 予測分析（駐車場混雑／利用率分析）  

---

## 第7章 付録／参照資料

### 7.1 用語集

| 用語 | 説明 |
|------|------|
| HarmoNet | 本アプリケーション名 |
| MVP | Minimum Viable Product |
| マジックリンク | パスワードレス認証方式 |
| 翻訳マスタ | UI固定文言の多言語翻訳テーブル |
| Prisma ORM | 型安全なDBマッピングツール |
| Push通知 | システムからユーザーへの自動通知 |
| テナント | 複数物件管理における論理区分 |

---

### 7.2 関連ドキュメント

| 名称 | 内容 |
|------|------|
| HarmoNet デザインガイドライン | UI/UX仕様（外部参照） |
| HarmoNet 画面設計書 | 各画面のレイアウトと遷移 |
| HarmoNet DB設計書 | Prismaスキーマ、ER図 |
| HarmoNet API仕様書 | REST/GraphQL仕様 |
| HarmoNet インフラ構成図 | Vercel+Supabase構成 |
| HarmoNet セキュリティガイドライン | 脆弱性・暗号化方針 |
| HarmoNet ユーザーマニュアル | 住民向け利用説明（多言語） |

---

### 7.3 外部サービス一覧

| サービス | 用途 | 備考 |
|-----------|------|------|
| Google Cloud Translation | 動的翻訳 | 月50万文字無料 |
| Firebase Cloud Messaging | プッシュ通知 | 無料 |
| SendGrid | メール通知 | 月100通無料 |
| Supabase | DB＋Auth＋Storage | オープンソース |
| Vercel | デプロイ／CDN | 無料枠あり |

---

### 7.4 リスク管理

| リスク | 影響 | 対策 |
|--------|------|------|
| Translation API超過 | 中 | 使用量監視／キャッシュ活用 |
| API障害 | 高 | リトライ＋代替手段 |
| セキュリティ事故 | 高 | 定期診断・多層防御 |
| 開発遅延 | 中 | フェーズ分割・優先順位明確化 |
| 住民利用率低下 | 高 | UI改善・説明会開催 |

---

### 7.5 文書承認

| 役割 | 氏名 | 承認日 |
|------|------|--------|
| プロジェクトオーナー | ______ | ____ |
| 開発リーダー | ______ | ____ |

**変更履歴**  
| バージョン | 日付 | 内容 | 作成者 |
|-------------|------|------|--------|
| 1.0 | 2025/10/26 | 初版作成 | TKD |
| 1.1 | 2025/10/27 | 掲示板・AIモデレーション追加 | TKD |
| 1.2 | 2025/10/30 | 消耗品照会機能／AI協調体制追記 | TKD |

---

文書管理番号: HARMONET-REQ-001  
分類: 要件定義書  
セキュリティレベル: 社外秘  
本資料は機密情報を含みます。無断での複製・配布を禁じます。

