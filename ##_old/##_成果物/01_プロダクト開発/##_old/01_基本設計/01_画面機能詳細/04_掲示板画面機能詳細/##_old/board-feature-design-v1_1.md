# 掲示板機能 詳細設計書 v1.1

**セキュレアシティ スマートコミュニケーションアプリ**

**文書ID**: SEC-APP-BOARD-DESIGN-001  
**最終更新**: 2025年10月27日

---

## 📝 改訂履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| v1.0 | 2025年10月 | 初版作成（機能要件、データベース設計、API設計、工数見積を含む総合設計書） |
| v1.1 | 2025年10月27日 | 機能要件に特化。AI自動モデレーション（差別的表現検知含む）をMVP必須化。承認フローを削除し管理者負担を最小化。画面構成・遷移、UI/UX仕様、投稿ガイドラインを強化。技術実装詳細（DB設計、API設計、工数）を除外 |

---

## 目次

1. [概要](#1-概要)
2. [MVP機能セット](#2-mvp機能セット)
3. [掲示板の種類](#3-掲示板の種類)
4. [画面構成](#4-画面構成)
5. [画面遷移フロー](#5-画面遷移フロー)
6. [カテゴリ管理](#6-カテゴリ管理)
7. [投稿機能](#7-投稿機能)
8. [コメント機能](#8-コメント機能)
9. [添付ファイル機能](#9-添付ファイル機能)
10. [既読管理機能（回覧板）](#10-既読管理機能回覧板)
11. [通報機能](#11-通報機能)
12. [翻訳機能](#12-翻訳機能)
13. [管理者機能](#13-管理者機能)
14. [モデレーション機能](#14-モデレーション機能)
15. [データエクスポート機能](#15-データエクスポート機能)
16. [投稿ガイドライン](#16-投稿ガイドライン)

---

## 1. 概要

### 1.1 目的と背景

本掲示板機能は、セキュレアシティ住民間の情報共有および管理組合からの周知事項配信を行うコミュニケーション基盤です。大規模分譲住宅地における多様な世帯（日本語話者・外国語話者・高齢者・子育て世帯など）を対象とし、以下を目的とします：

- **心理的な安心感の提供** - 誰もが安心して投稿できる環境
- **運用コストの低減** - 管理者の負担を最小限に抑える
- **差別化要素の実現** - グループ掲示板による棟・棟単位のコミュニケーション
- **多言語対応** - 日本語・英語・中国語での情報共有

### 1.2 基本方針

**設計の前提条件**

- 「荒れないこと」を最優先
- 管理者が疲弊しない仕組み
- スマホファーストのUI/UX
- 段階的な機能拡張が可能な設計

**重要な設計判断**

- **AI自動モデレーションをMVP必須化**: 近隣住民同士のコミュニティでは、荒れたら実生活に深刻な影響が出るため、投稿前の自動チェックと表現変換により「荒れない環境」を確保
- **承認フローの不採用**: 管理組合の理事はボランティアであり、投稿ごとの承認判断は非現実的。AI自動処理と事後の通報対応により、管理者負担を最小化
- **差別的表現の完全排除**: 日本人・外国人が共存するコミュニティのため、人種・国籍・性別などに関する差別的表現を徹底的に検知・ブロック

---

## 2. MVP機能セット

### 2.1 実装する機能一覧

| 機能 | 実装範囲 | 優先度 |
|------|---------|--------|
| **掲示板種類** | 全体掲示板 + グループ掲示板 + 回覧板 | MVP必須 |
| **投稿機能** | タイトル・本文・カテゴリ・添付ファイル | MVP必須 |
| **添付ファイル** | 画像プレビュー / PDF・Office（ダウンロードのみ） | MVP必須 |
| **コメント** | 1階層返信のみ | MVP必須 |
| **表示制御** | ニックネーム表示、返信可/不可制御 | MVP必須 |
| **管理機能** | 自分の投稿削除、通報機能、既読管理（回覧板） | MVP必須 |
| **多言語** | 翻訳ボタン（Google Translation API） | MVP必須 |
| **モデレーション** | AI自動処理（ブロック・変換）+ NGワードフィルタ | MVP必須 |

### 2.2 将来実装機能（Phase 2以降）

| 機能 | 概要 | 想定フェーズ |
|------|------|-------------|
| **リアクション機能** | 「いいね」「参考になった」などの簡易リアクション | Phase 2 |
| **検索機能** | キーワード検索、カテゴリ検索、投稿者検索 | Phase 2 |
| **通知設定** | 新着投稿・コメント・返信の通知ON/OFF | Phase 2 |
| **下書き保存** | 投稿中の下書きを保存・再編集 | Phase 2 |
| **既読期限機能** | 回覧板の既読期限設定と未読者への自動通知 | Phase 2 |

---

## 3. 掲示板の種類

### 3.1 全体掲示板（一般掲示板）

- **対象**: セキュレアシティ全住民
- **用途**: コミュニティ全体に関わる話題・質問・情報共有
- **投稿権限**: 全住民が投稿可能
- **閲覧権限**: 全住民が閲覧可能
- **特徴**:
  - ニックネーム表示が基本
  - 誰でも返信可能
  - カテゴリによる分類（イベント、質問、情報共有など）

### 3.2 グループ掲示板 ★差別化要素

**差別化のポイント**

グループ掲示板は、**カテゴリベースの権限制御**によって実現します。画面は統一され、表示されるカテゴリのみが異なります。

- **対象**: 特定の棟・エリア・グループのみ
- **用途**: 棟内の連絡事項、棟固有の問題・相談
- **投稿権限**: 該当グループメンバーのみ
- **閲覧権限**: 該当グループメンバーのみ
- **実装方法**:
  - カテゴリに`group_id`を紐付け
  - ユーザーの所属グループIDと照合して表示制御
  - 画面は全体掲示板と統一、カテゴリ選択肢のみ異なる

**想定されるグループ例**

- A棟住民専用
- B棟住民専用
- 1階住民専用（宅配ボックス関連）
- 子育て世帯限定グループ

### 3.3 回覧板・重要お知らせ

- **対象**: 管理組合からの公式通知
- **用途**: 総会案内、工事予定、緊急連絡など
- **投稿権限**: 管理者のみ
- **閲覧権限**: 全住民（グループ回覧も可能）
- **特徴**:
  - 実名表示（管理組合名義）
  - 返信不可
  - 既読管理機能あり
  - 未読者に通知送信

---

## 4. 画面構成

### 4.1 掲示板一覧画面

#### 4.1.1 画面要素

**ヘッダー**
- 画面タイトル「掲示板」
- 検索アイコン（Phase 2）
- 新規投稿ボタン（FAB: Floating Action Button）

**安心感を提供するバナー**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛡️ この掲示板は安全に運用されています
・不適切な投稿は自動的にブロック
・通報機能による迅速な対応
・管理者が常時監視
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**タブ切り替え**
- 「すべて」「全体掲示板」「グループ掲示板」「回覧板」
- 未読バッジ表示

**投稿カード**
- カテゴリバッジ（色分け）
- タイトル（太字、最大2行）
- 本文プレビュー（1行、グレー文字）
- 投稿者ニックネーム、投稿日時
- 添付ファイルアイコン（画像/PDF/Office）
- コメント数アイコン
- 既読/未読アイコン（回覧板のみ）

**フィルター**
- カテゴリフィルター（Phase 2）
- 並び順（新着順、コメント順）

#### 4.1.2 レイアウト仕様

- 投稿カードは縦スクロール、無限スクロール対応（20件ずつ読み込み）
- タップで投稿詳細画面へ遷移
- スワイプでカテゴリタブ切り替え可能

**UI/UXポイント**

- 回覧板は必ず最上部に固定表示（未読がある場合）
- 新着投稿は「NEW」バッジ表示（24時間以内）
- 自分の投稿には「あなたの投稿」マーク

### 4.2 投稿詳細画面

#### 4.2.1 画面要素

**ヘッダー**
- 戻るボタン
- 共有ボタン（Phase 2）
- 三点メニュー（通報、自分の投稿なら編集・削除）

**投稿本文エリア**
- カテゴリバッジ
- タイトル（大きめフォント）
- 投稿者情報（ニックネーム/実名、投稿日時）
- 本文（全文表示）
- 翻訳ボタン（言語切り替え）
- 添付ファイル表示エリア（画像プレビュー、PDF/Officeダウンロードリンク）

**既読状況エリア（回覧板のみ）**
- 既読人数 / 全体人数
- 「既読にする」ボタン

**コメントエリア**
- コメント一覧（投稿順）
- 各コメント: ニックネーム、本文、投稿日時、翻訳ボタン
- コメント入力欄（返信可の場合のみ表示）

#### 4.2.2 添付ファイル表示

- **画像ファイル**: サムネイル表示、タップで拡大表示（ライトボックス）
- **PDF・Officeファイル**: ファイル名とアイコン、ダウンロードボタン
- 複数添付の場合は横スクロール（最大5ファイル）

### 4.3 新規投稿画面

#### 4.3.1 画面要素

**ヘッダー**
- 「×」キャンセルボタン
- 「投稿する」ボタン（右上）

**安全な投稿のための注意表示**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 投稿前にご確認ください

・不適切な投稿は自動的にブロックされます
・攻撃的な表現は自動的に適切な表現に変換されます
・匿名投稿でも内容から特定される可能性があります

詳しくは「投稿ガイドライン」をご覧ください
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**入力フォーム**
- カテゴリ選択（ドロップダウン、必須）
- タイトル入力（テキストボックス、最大50文字、必須）
- 本文入力（テキストエリア、最大2000文字、必須）
- 添付ファイル選択ボタン（最大5ファイル、合計10MB）
- 添付プレビュー表示エリア（削除可能）

#### 4.3.2 バリデーション

- 必須項目の未入力チェック
- 文字数制限の超過チェック
- 添付ファイルサイズ・数の制限チェック
- NGワードフィルタ（リアルタイムチェック）
- AI自動モデレーション（投稿ボタン押下時）
- エラーメッセージはフィールド直下に赤文字で表示

### 4.4 管理者画面（回覧板作成）

#### 4.4.1 画面要素

通常の投稿画面に加えて以下を設定可能：

- 「回覧板として投稿」チェックボックス
- 対象グループ選択（全体 or 特定グループ）
- 既読期限設定（任意、例: 7日以内に既読必須）（Phase 2）

---

## 5. 画面遷移フロー

### 5.1 基本遷移パターン

```
ホーム画面
  ↓
掲示板一覧画面（タブ: すべて/全体/グループ/回覧板）
  ↓
投稿詳細画面
  ↓ (コメント入力)
コメント投稿完了 → 投稿詳細画面に戻る
  ↓ (戻るボタン)
掲示板一覧画面に戻る

---

新規投稿フロー:
掲示板一覧画面
  ↓ (FABタップ)
新規投稿画面
  ↓ (投稿ボタン)
AI自動チェック（0.5秒）
  ↓
投稿完了 → 投稿詳細画面へ自動遷移
```

### 5.2 ユーザーアクション別遷移

#### ① 投稿閲覧フロー

1. 掲示板一覧画面で投稿カードをタップ
2. 投稿詳細画面へ遷移
3. 本文・添付ファイル・コメントを閲覧
4. 戻るボタンで一覧画面へ戻る

#### ② 投稿作成フロー

1. 掲示板一覧画面でFABタップ
2. 新規投稿画面へ遷移
3. カテゴリ・タイトル・本文・添付ファイルを入力
4. 「投稿する」ボタンをタップ
5. AI自動チェック（ブロック or 変換提案 or OK）
6. 投稿完了後、作成した投稿の詳細画面へ自動遷移

#### ③ コメント投稿フロー

1. 投稿詳細画面でコメント入力欄に文字入力
2. 「送信」ボタンをタップ
3. AI自動チェック
4. コメント投稿完了、同じ投稿詳細画面をリロード
5. 新しいコメントが表示される

#### ④ 回覧板既読フロー

1. 掲示板一覧画面で回覧板タブを選択
2. 未読の回覧板をタップ
3. 投稿詳細画面で内容を確認
4. 「既読にする」ボタンをタップ
5. 既読状態に更新、一覧画面に戻ると未読バッジが消える

#### ⑤ 通報フロー

1. 投稿詳細画面で三点メニューをタップ
2. 「通報する」を選択
3. 通報理由選択画面へ遷移
4. 理由を選択し「送信」ボタンをタップ
5. 通報完了メッセージ表示、投稿詳細画面に戻る

---

## 6. カテゴリ管理

### 6.1 カテゴリの設計方針

**カテゴリは管理者が事前に登録するマスター方式**を採用します。ユーザーが自由にタグを作成する方式（SNS型）は採用しません。

**理由**

- 投稿が分散しすぎるのを防ぐ
- 誤字・表記ゆれを防ぐ（「イベント」「いべんと」「event」など）
- 管理者が意図したカテゴリ構成を維持できる

### 6.2 カテゴリの種類

| カテゴリタイプ | 説明 | 表示対象 |
|--------------|------|---------|
| **共通カテゴリ** | 全住民が利用可能なカテゴリ | 全ユーザー |
| **グループ専用カテゴリ** | 特定グループのみが利用可能 | 該当グループメンバーのみ |
| **管理者専用カテゴリ** | 回覧板・公式お知らせ用 | 管理者のみ投稿可能 |

### 6.3 標準カテゴリ例

#### 共通カテゴリ（全体掲示板）

- 📣 お知らせ（管理組合公式）
- ❓ 質問・相談
- 💬 雑談・交流
- 🎉 イベント情報
- 🔧 不具合・修繕
- 🚗 駐車場・駐輪場
- 📦 宅配・ゴミ出し
- 👶 子育て情報
- 🐾 ペット関連
- 🏪 周辺情報（店舗・施設）

#### グループ専用カテゴリ例

- 🏢 A棟連絡事項
- 🏢 B棟連絡事項
- 🏢 1階住民専用

#### 管理者専用カテゴリ

- 📋 回覧板（重要）
- ⚠️ 緊急連絡

### 6.4 カテゴリのUI表示

- **バッジ形式**: カテゴリ名を小さなバッジで表示（背景色で色分け）
- **色の割り当て**: カテゴリごとに固定色を設定（青、緑、オレンジなど）
- **表示位置**: 投稿カードの左上、投稿詳細画面のタイトル上

**デザイン注意点**

カテゴリ表示は目立ちすぎないよう、シンプルで控えめなデザインにします。SNSのような派手なタグ表示は避けます。

### 6.5 管理者によるカテゴリ管理画面

#### 機能

- カテゴリの追加・編集・削除
- カテゴリの有効/無効切り替え
- カテゴリの表示順変更（ドラッグ＆ドロップ）
- カテゴリの色・アイコン設定
- グループIDの紐付け設定

#### 無効化の動作

- 無効化されたカテゴリは新規投稿時の選択肢に表示されない
- 既存の投稿は引き続き表示される（カテゴリバッジはグレーアウト）

---

## 7. 投稿機能

### 7.1 投稿フォーム仕様

| 項目 | 必須 | 制限 |
|------|------|------|
| カテゴリ | 必須 | ドロップダウンから1つ選択 |
| タイトル | 必須 | 最大50文字 |
| 本文 | 必須 | 最大2000文字 |
| 添付ファイル | 任意 | 最大5ファイル、合計10MB |

### 7.2 投稿時の自動設定項目

- **投稿者**: ログインユーザーの情報（ニックネーム or 実名）
- **投稿日時**: 投稿ボタン押下時のタイムスタンプ
- **掲示板タイプ**: カテゴリから自動判定（全体 / グループ / 回覧板）
- **返信可能フラグ**: 回覧板の場合は自動的に「返信不可」

### 7.3 投稿の編集・削除

#### 編集

- **対象**: 自分の投稿のみ
- **編集可能項目**: タイトル、本文、添付ファイル
- **編集不可項目**: カテゴリ（投稿後は変更不可）
- **履歴表示**: 「編集済み」マーク表示（Phase 2で編集履歴詳細）

#### 削除

- **対象**: 自分の投稿のみ
- **確認ダイアログ**: 「本当に削除しますか？」を表示
- **削除後**: 投稿データは論理削除（物理削除はしない）
- **表示**: 「この投稿は削除されました」と表示（コメントは残る）

**管理者による削除**

管理者は全ての投稿を削除可能です。削除理由を入力し、投稿者に通知します。

### 7.4 投稿時のAI自動処理

投稿ボタン押下後、AIが自動的に内容をチェックします。

#### 処理の流れ

```
投稿ボタン押下
  ↓
[投稿内容を確認中...] 表示（0.5秒）
  ↓
AI自動判定（3段階）
  ↓
レベル1: ブロック → エラー表示、修正を促す
レベル2: 変換提案 → 変換後の文章を表示、選択可能
レベル3: OK → 即座に投稿完了
```

詳細は「14. モデレーション機能」を参照。

---

## 8. コメント機能

### 8.1 コメント仕様

#### 基本仕様

- **階層**: 1階層のみ（投稿に対するコメントのみ、コメントへの返信は不可）
- **文字数制限**: 最大500文字
- **添付ファイル**: コメントには添付不可（MVP）
- **投稿者表示**: ニックネーム表示

#### 表示順

- 投稿日時の昇順（古いコメントが上）
- Phase 2で「新着順」「いいね順」などのソート機能追加を検討

### 8.2 コメントの編集・削除

- **編集**: 自分のコメントのみ編集可能
- **削除**: 自分のコメントのみ削除可能
- **管理者権限**: 管理者は全てのコメントを削除可能

### 8.3 返信不可投稿の扱い

- 回覧板など、返信不可に設定された投稿では、コメント入力欄が表示されない
- 「この投稿には返信できません」というメッセージを表示

---

## 9. 添付ファイル機能

### 9.1 対応ファイル形式

| ファイル種類 | 対応形式 | MVP機能 |
|-------------|---------|---------|
| **画像** | JPEG, PNG, GIF, WebP | プレビュー表示、拡大表示 |
| **PDF** | PDF | ダウンロードのみ（プレビューはPhase 2） |
| **Office** | Word (.docx), Excel (.xlsx), PowerPoint (.pptx) | ダウンロードのみ |

### 9.2 ファイルサイズ制限

- **1ファイルあたり**: 最大5MB
- **1投稿あたり**: 最大5ファイル、合計10MB
- 制限超過時はエラーメッセージ表示

### 9.3 画像プレビュー機能

#### 一覧画面での表示

- 投稿カードに添付画像の1枚目をサムネイル表示
- 複数枚ある場合は「+3」のようなバッジ表示

#### 詳細画面での表示

- 画像は横スクロールで全て表示
- タップでライトボックス（全画面表示）
- ピンチイン・アウトで拡大縮小

### 9.4 PDF・Officeファイルの扱い

- **表示方法**: ファイル名とアイコン（PDF、Word、Excelなど）
- **ダウンロード**: タップでダウンロード開始
- **プレビュー**: Phase 2で実装予定（ブラウザ内プレビュー）

### 9.5 権限別の添付制御

| ユーザー種別 | 添付可能ファイル | 制限 |
|-------------|----------------|------|
| 一般住民 | 画像、PDF | 最大5ファイル、合計10MB |
| 管理者 | 画像、PDF、Office | 最大10ファイル、合計20MB |

**管理者の添付制限緩和の理由**

管理組合からの公式通知では、総会資料や工事図面など、大容量ファイルを添付する必要があるため、制限を緩和します。

---

## 10. 既読管理機能（回覧板）

### 10.1 既読管理の目的

管理組合からの重要なお知らせ（総会案内、工事予定、緊急連絡など）を住民全員が確実に確認したかを把握するための機能です。

### 10.2 既読ステータス

| ステータス | 説明 |
|-----------|------|
| **未読** | 投稿を開いていない、または「既読にする」ボタンを押していない |
| **既読** | 「既読にする」ボタンを押した |

### 10.3 既読管理の動作

#### ユーザー側

1. 回覧板タブに未読バッジ表示
2. 投稿詳細画面で「既読にする」ボタンを押す
3. 既読状態に更新され、未読バッジが消える
4. 既読後は「既読済み」マーク表示

#### 管理者側

1. 回覧板投稿の詳細画面で既読状況を確認
2. 「既読: 45人 / 全体: 50人（90%）」のように表示
3. 未読者リストを確認可能（Phase 2）
4. 未読者に個別通知を送信可能（Phase 2）

### 10.4 既読期限機能（Phase 2）

- 管理者が回覧板作成時に既読期限を設定可能（例: 7日以内）
- 期限が近づくと未読者に通知
- 期限超過後も投稿は表示され続けるが、「期限超過」マーク表示

---

## 11. 通報機能

### 11.1 通報の目的

不適切な投稿やコメントを住民が管理者に報告し、コミュニティの安全性を保つための機能です。

### 11.2 通報対象

- 投稿本文
- コメント

### 11.3 通報理由

- 不適切な内容（暴言、誹謗中傷）
- スパム・宣伝
- 個人情報の漏洩
- 差別的な表現
- その他（自由記述）

### 11.4 通報フロー

#### ユーザー側

1. 投稿詳細画面の三点メニューから「通報する」を選択
2. 通報理由を選択
3. 補足説明を入力（任意、最大200文字）
4. 「送信」ボタンをタップ
5. 通報完了メッセージ表示

#### 管理者側

1. 管理者画面で通報一覧を確認
2. 通報内容を確認し、対応を判断
3. 必要に応じて投稿・コメントを削除
4. 通報者・投稿者に対応結果を通知（Phase 2）

### 11.5 通報の重複防止

- 同じユーザーが同じ投稿を複数回通報できないよう制御
- 既に通報済みの場合は「通報済み」と表示

**悪用防止**

通報機能の悪用（嫌がらせ目的の通報）を防ぐため、通報履歴を記録し、悪質なユーザーには警告を行います。

---

## 12. 翻訳機能

### 12.1 翻訳の目的

日本語・英語・中国語の住民が互いに理解できるよう、投稿本文とコメントを自動翻訳します。

### 12.2 対応言語

- 日本語 ⇔ 英語
- 日本語 ⇔ 中国語（簡体字）
- 英語 ⇔ 中国語（簡体字）

### 12.3 翻訳方法

- **翻訳API**: Google Translation API
- **翻訳ボタン**: 投稿本文・コメントごとに「翻訳」ボタンを配置
- **動作**: ボタンをタップすると、選択中の言語に翻訳（元の文章と入れ替え表示）
- **戻す**: もう一度ボタンをタップすると元の言語に戻る

### 12.4 翻訳表示の工夫

- 翻訳後は「翻訳済み」マークを表示
- 元の言語を小さく表示（例: 「原文: 日本語」）
- 翻訳精度が低い可能性がある場合は注意書き表示

**翻訳のキャッシュ**

同じ文章の翻訳は一度行ったらキャッシュし、翻訳APIの呼び出し回数を削減します。

---

## 13. 管理者機能

### 13.1 管理者権限の種類

| 権限レベル | 対象 | できること |
|-----------|------|-----------|
| **スーパー管理者** | 管理組合理事長 | 全機能の利用、他の管理者の権限設定 |
| **管理者** | 管理組合理事 | 投稿削除、通報対応、カテゴリ管理、回覧板作成 |
| **モデレーター** | 選任された住民 | 通報対応、投稿削除のみ |

### 13.2 管理者画面の構成

#### ダッシュボード

- 投稿数・コメント数・アクティブユーザー数の統計
- 未対応の通報件数
- 既読率が低い回覧板の一覧

#### 投稿管理

- 全投稿の一覧表示
- 投稿の検索・フィルタリング
- 投稿の編集・削除

#### 通報管理

- 通報一覧の表示
- 通報内容の詳細確認
- 対応状況の更新（未対応、対応中、完了）

#### カテゴリ管理

- カテゴリの追加・編集・削除
- カテゴリの有効/無効切り替え
- グループIDの紐付け設定

#### 回覧板管理

- 回覧板の作成
- 既読状況の確認
- 未読者への通知送信（Phase 2）

#### モデレーション設定

- NGワードの追加・編集・削除
- AI自動処理の厳格度調整（初期/安定期/成熟期）

### 13.3 管理者の役割（最小化）

#### やること

1. **システム設定**
   - NGワード追加・削除
   - カテゴリ管理
   - モデレーション設定の調整

2. **事後対応のみ**
   - 通報があった投稿の確認
   - 削除判断（通報が妥当な場合）

3. **定期確認**
   - 月1回、全投稿を流し読み
   - 問題がないか確認

#### やらないこと

- ❌ 投稿の事前承認
- ❌ 投稿の編集
- ❌ 日常的な監視

**理由**

管理組合の理事はボランティアであり、投稿ごとの承認判断は非現実的です。AI自動処理により、管理者の負担を最小限に抑えます。

---

## 14. モデレーション機能

### 14.1 モデレーションの目的と重要性

**目的**

近隣住民同士のコミュニティでは、荒れたら実生活に深刻な影響が出るため、「荒れない環境」の確保が最優先です。

**重要性**

- 匿名ではない（結局誰が書いたか分かる）
- 逃げられない（毎日顔を合わせる）
- トラブルになったら生活に支障

**「自動モデレーションなし」= 「誰も投稿しない掲示板」になるリスクが極めて高い**

### 14.2 AI自動処理の3段階判定

投稿・コメント送信時、AIが自動的に内容をチェックし、3段階で判定します。

#### レベル1：即座にブロック（投稿不可）

以下の内容を含む投稿は即座にブロックされ、投稿できません。

**ブロック対象**

1. **誹謗中傷・暴言・差別表現**
   - 「バカ」「アホ」「死ね」「最低」「クズ」など
   - 人格否定の表現全般

2. **人種・民族・国籍差別**
   - 「外国人は○○」「中国人が」「韓国人が」
   - 「○○人は△△だ」（ステレオタイプ）
   - 人種・国籍を理由にした批判

3. **性別・年齢による差別**
   - 「女性なんだから」「男のくせに」
   - 「主婦は」「独身は」「老人は」「若者は」
   - 性別・年齢によるステレオタイプ

4. **個人特定情報**
   - 部屋番号（「301号室」「3階の角部屋」）
   - 個人名（「Aさん」「B棟の○○さん」）
   - 個人を特定できる特徴（「赤い車の人」「犬を飼ってる人」）

5. **個人情報**
   - 電話番号
   - メールアドレス
   - 詳細住所

6. **性的・暴力的表現**

7. **NGワード**（管理者が設定）

**ブロック時の表示**

```
❌ 投稿できませんでした

理由：
・部屋番号が含まれています
・攻撃的な表現が含まれています

内容を修正してから再度投稿してください。

[ 内容を修正する ]
```

#### レベル2：自動変換提案 ★核心機能

攻撃的だが改善可能な表現を、自動的に適切な表現に変換して提案します。

**変換対象**

1. 攻撃的だが改善可能な表現
2. 無意識の差別的表現（本人は差別の意図なし）
3. 感情的な表現
4. 特定リスクのある表現（部屋番号、階数、具体的日時）

**変換例**

| 元の表現 | 問題点 | 変換後 |
|---------|--------|--------|
| 「上の階の人、夜中うるさすぎる。いい加減にしろ」 | 攻撃的、特定リスク | 「上階の部屋から夜間に生活音が聞こえ、困っています。改善していただけると助かります」 |
| 「外国人は夜中にうるさい」 | 人種差別 | 「夜間に生活音が聞こえることがあります」 |
| 「中国人がゴミを放置」 | 国籍差別 | 「ゴミ出しルールの周知をお願いします」 |
| 「日本のルールを守れ」 | 国籍差別的文脈 | 「共用部の利用ルールの確認をお願いします」 |
| 「言葉が通じない人が増えた」 | 差別的文脈 | 「多言語対応の案内板設置を検討してほしい」 |
| 「女性なんだから静かに」 | 性別差別 | 「生活音への配慮をお願いします」 |
| 「301号室」 | 個人特定 | 「ある部屋」 |
| 「昨日の夜10時」 | 特定リスク | 「夜遅い時間帯」 |

**変換提案時の表示**

```
⚠️ より適切な表現に変換しました

【あなたの文章】
「上の階の人、夜中うるさすぎる。いい加減にしろ」

【変換後の提案】
「上階の部屋から夜間に生活音が聞こえ、困っています。
改善していただけると助かります」

【なぜ変換が必要か】
・攻撃的な表現は近隣トラブルの原因になります
・「人」→「部屋」に変更し、特定リスクを低減
・解決を促す丁寧な依頼表現に変更

【変更内容】
・攻撃的表現 → 丁寧な依頼表現
・「人」→ 特定避けのため「部屋」
・感情的表現 → 客観的表現

[ この表現で投稿する ]（推奨）
[ 自分で修正する ]
[ キャンセル ]
```

#### レベル3：そのまま投稿

問題なし → 即座に公開

### 14.3 使用するAI

- **メインAI**: OpenAI GPT-4（自動変換用）
- **サブAI**: OpenAI Moderation API（不適切コンテンツ検知）

### 14.4 NGワードフィルタ

管理者が登録したNGワードを含む投稿は即座にブロックされます。

**機能**

- NGワードの追加・編集・削除（管理者のみ）
- 正規表現によるパターンマッチング対応
- リアルタイムチェック（入力中にアラート表示）

### 14.5 段階的な厳格度調整

コミュニティの成熟度に応じて、モデレーションの厳格度を調整します。

#### 初期（最初の3ヶ月）

```
レベル1（ブロック）: 厳格
レベル2（変換提案）: 積極的に提案
↓
結果：ほとんどの投稿が変換される
目的：住民に適切な表現を学習させる
```

#### 安定期（3ヶ月後〜）

```
レベル1（ブロック）: 厳格維持
レベル2（変換提案）: 本当に必要な時だけ
↓
結果：住民が適切な表現を学習済み
```

#### 成熟期（1年後〜）

```
レベル1（ブロック）: 厳格維持
レベル2（変換提案）: ほぼ不要に
↓
結果：コミュニティが成熟し、自主的に適切な投稿
```

### 14.6 多層防御システム

```
投稿
 ↓
[1層] NGワードフィルタ → 即ブロック
 ↓
[2層] OpenAI Moderation API → ヘイト・暴力表現検知
 ↓
[3層] GPT-4による判定と変換
       ├→ レベル1（差別的表現など）→ ブロック
       ├→ レベル2（攻撃的表現など）→ 変換提案
       └→ レベル3（問題なし）→ OK
 ↓
[4層] 通報機能（投稿後）
 ↓
[5層] 管理者確認（通報時のみ）
```

### 14.7 投稿フロー（完全版）

```
投稿ボタン押下
  ↓
[投稿内容を確認中...] 表示（0.5秒）
  ↓
AI自動判定（3段階）
  ↓
┌─────────────┬─────────────┬─────────────┐
│  レベル1: ブロック │  レベル2: 変換提案  │  レベル3: OK    │
│                   │                   │                │
│  エラー表示        │  変換後の文章表示   │  即座に投稿完了  │
│  修正を促す        │  選択可能          │                │
└─────────────┴─────────────┴─────────────┘
```

---

## 15. データエクスポート機能

### 15.1 エクスポートの目的

管理組合の総会資料作成、監査対応、年次報告書作成のため、掲示板データをエクスポートします。

### 15.2 エクスポート対象データ

- 投稿データ（タイトル、本文、投稿者、投稿日時、カテゴリ）
- コメントデータ
- 添付ファイル情報（ファイル名、サイズ）
- 既読状況（回覧板のみ）

### 15.3 エクスポート機能詳細

#### 15.3.1 エクスポート条件設定

- **期間指定**: 開始日〜終了日
- **カテゴリ指定**: 特定カテゴリのみ、または全カテゴリ
- **掲示板タイプ**: 全体/グループ/回覧板の選択
- **アーカイブ済み投稿**: 含める/含めない
- **削除済み投稿**: 含める/含めない

#### 15.3.2 エクスポート形式

**① CSV形式**

- **用途**: Excelでの集計・分析
- **ファイル名**: 掲示板エクスポート_YYYYMMDD_HHMMSS.csv
- **出力項目**: 投稿ID、投稿日時、投稿タイプ、カテゴリ、タイトル、投稿者、グループ名、閲覧数、コメント数、添付ファイル数、アーカイブ状態
- **エンコーディング**: UTF-8 BOM付き（Excel対応）

**② PDF形式**

- **用途**: 総会資料、監査資料、印刷物
- **ファイル名**: 掲示板エクスポート_YYYYMMDD_HHMMSS.pdf
- **構成**:
  - 表紙（タイトル、期間、出力日）
  - 目次（カテゴリ別）
  - 各投稿の詳細（タイトル、投稿日時、カテゴリ、投稿者、本文、添付ファイル情報、既読状況）

**③ JSON形式**

- **用途**: データ移行、API連携、バックアップ
- **ファイル名**: 掲示板エクスポート_YYYYMMDD_HHMMSS.json
- **構造**: エクスポート情報（期間、フィルター条件）、投稿配列（投稿詳細、コメント配列、添付ファイル配列、既読状況）

#### 15.3.3 エクスポート処理の流れ

1. 管理者が条件を指定
2. 「プレビュー」ボタンで該当件数を表示（例: 「該当: 127件」）
3. 「エクスポート実行」ボタンをクリック
4. ローディング表示（「エクスポート中...」）
5. ファイル生成（バックグラウンド処理）
6. 生成完了後、ダウンロードリンクを表示
7. 24時間以内にダウンロード（期限後自動削除）

**エクスポート履歴**

管理者は過去のエクスポート履歴を確認でき、再ダウンロードも可能です（24時間以内）。

---

## 16. 投稿ガイドライン

### 16.1 安全な投稿のために

#### 匿名投稿の注意点

匿名・ニックネームで投稿しても、**内容によっては投稿者が推測される可能性があります。**

**避けるべき情報**

- ✗ 部屋番号（「301号室」など）
- ✗ 具体的な階数（「3階」→「上階」「中層階」）
- ✗ 特定の日時（「昨日の夜10時」→「夜遅い時間」）
- ✗ 個人の特徴（車種、職業、家族構成）
- ✗ 具体的な場所（「A棟東側」→「ある棟」）

**推奨表現**

- ✓ 「ある部屋」「上の階」「隣の部屋」
- ✓ 「最近」「夜遅い時間」「週末」
- ✓ 「駐車場で」「エントランス付近で」

#### 苦情・クレームについて

騒音や迷惑行為などのご相談は、まず管理組合にご連絡ください。

掲示板での投稿は、近隣トラブルに発展する可能性があります。

### 16.2 多文化共生コミュニティのために

セキュレアシティには、様々な国籍・文化的背景を持つ住民が暮らしています。お互いを尊重し、安心して暮らせるコミュニティを作りましょう。

#### 投稿時の注意事項

**❌ 避けるべき表現**

**国籍・人種への言及**
- ✗ 「外国人は○○」
- ✗ 「中国人が」「アメリカ人が」
- ✗ 「日本のルールを守らない」

**性別・年齢への決めつけ**
- ✗ 「女性なんだから」
- ✗ 「若者は」「高齢者は」

**✓ 推奨表現**

**問題を客観的に**
- ✓ 「夜間に生活音が聞こえます」
- ✓ 「ゴミ出しルールの周知をお願いします」
- ✓ 「共用部の利用について相談したい」

**解決策を提案**
- ✓ 「多言語での案内板設置を検討してほしい」
- ✓ 「ルールブックの翻訳版があると助かります」

#### 大切なこと

**問題があるのは人種や国籍ではなく、行動です。**

良い例：
「夜間の生活音について配慮をお願いします」

悪い例：
「○○人は夜中うるさい」

### 16.3 投稿が自動的にチェックされます

投稿時、以下の内容は自動的にブロックまたは変換されます：

- 誹謗中傷・暴言
- 差別的表現（人種、国籍、性別など）
- 個人を特定できる情報
- 攻撃的な表現

適切な表現への変換案が提示されますので、安心してご利用ください。

---

## 補足

本資料は機能要件定義書です。技術実装の詳細（データベース設計、APIエンドポイント設計、工数見積もり）は別資料で管理します。

**文書ID**: SEC-APP-BOARD-DESIGN-001  
**作成日**: 2025年10月27日  
**バージョン**: 1.1

---

セキュレアシティ スマートコミュニケーションアプリ  
掲示板機能 詳細設計書
