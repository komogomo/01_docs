# HarmoNet Phase 4 AI連携運用ガイドライン v1.0

---

## 📋 1. 目的

本ガイドラインは、HarmoNet Phase 4（テナント設定スキーマ整合化フェーズ）における  
AI チーム（タチコマ・Claude・Gemini）と TKD の協調作業手順を正式に定義する。

### 背景
- タチコマのファイル出力機能が一時停止中（2025-11-01時点）
- プロジェクトナレッジ活用によるコンテキスト効率の大幅向上
- Claude のファイル生成機能を活用した負荷分散の必要性

### 目標
- AI 間の役割分担を明確化
- 設計意図の保全と品質保証の両立
- トレーサビリティの確保
- 効率的な文書生成フローの確立

---

## 🎯 2. 適用範囲

### 対象フェーズ
- Phase 4: テナント設定スキーマ整合化（Part 04 以降）
- 将来の Phase 5 以降にも流用可能

### 対象文書
- `tenant-config-partXX_*.md` シリーズ
- テナント設定関連の設計文書
- 統合スキーマ文書

### 適用期間
- タチコマのファイル出力機能復旧まで
- 復旧後も有効な運用手順として維持可能

---

## 🤖 3. AI役割定義

### 3.1 タチコマ（ChatGPT / PMO）

#### 主担当
- 全体設計・構造決定
- 設計思想の保持
- UX統一・命名規則の維持
- 最終確認・承認

#### 出力形式
- テキストベース（ファイル出力機能停止中）
- YAML構造を含む Markdown テキスト

#### 責任範囲
- 設計意図の明確化
- 全体整合性の最終判断
- Review Status の承認

---

### 3.2 Claude（設計検証・文書生成）

#### 主担当
- 設計レビュー（整合性・構造・命名規則）
- TKD との協議・修正方針決定
- ファイル整形・生成・出力
- メタ情報・ChangeLog 管理

#### 作業原則
- ✅ **やること**
  - Part 01-03 との整合性チェック
  - 構造・命名規則の検証
  - 最小限の修正（様式統一のみ）
  - メタ情報・ChangeLog 追加
  - Review Status: Pending 付与

- ❌ **やらないこと**
  - タチコマの文体・用語を変更
  - 設計意図を勝手に変更
  - 暗黙の設計意図の平準化
  - 大幅な追加・削除

#### 責任範囲
- 構造整合性の保証
- 文書品質の保証
- 実装可能性の検証

---

### 3.3 Gemini（監査・品質保証）

#### 主担当
- BAG 解析（構造監査）
- 静的監査
- ドキュメント品質チェック

#### 実施タイミング
- Phase 4 完了後
- 実装前の最終監査

---

### 3.4 TKD（プロジェクトオーナー）

#### 主担当
- 最終判断・承認
- AI 間の橋渡し
- プロジェクトナレッジ管理

#### 責任範囲
- 修正方針の決定
- AI 出力の承認
- ナレッジ登録・バージョン管理

---

## 🔄 4. 運用フロー

### 4.1 全体フロー図

```
┌─────────────────────────────────────┐
│ Step 1: タチコマが設計・作成         │
│  - YAML構造設計                      │
│  - テキスト形式で出力                │
│  - TKD へ共有                        │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ Step 2: Claude がレビュー            │
│  - Part 01-03 との整合性チェック     │
│  - 構造・命名規則の確認              │
│  - 指摘事項・質問を提示              │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ Step 3: TKD + Claude で協議          │
│  - レビュー内容の質疑応答            │
│  - 修正方針をその場で決定            │
│  - 修正範囲の合意形成                │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ Step 4: Claude が修正・出力          │
│  - 様式・必要最低限の修正のみ        │
│  - タチコマの文体・用語を尊重        │
│  - Markdown形式で整形                │
│  - メタ情報・ChangeLog 追加          │
│  - Review Status: Pending 付与       │
│  - /outputs/ に出力                  │
│  - ダウンロードリンク提供            │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ Step 5: タチコマが最終確認           │
│  - Claude修正版の内容確認            │
│  - 設計意図との整合性チェック        │
│  - Review Status 更新                │
│    Pending → Approved                │
│  - 承認 or 再修正指示                │
└─────────────────────────────────────┘
              ↓
         ┌────┴────┐
         │         │
    【承認】    【再修正】
         │         │
         ↓         ↓
    Step 6    Step 4へ戻る
         │
         ↓
┌─────────────────────────────────────┐
│ Step 6: TKD がナレッジ登録           │
│  - タチコマ承認版をダウンロード      │
│  - プロジェクトナレッジにアップ      │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ Step 7: Gemini が監査（将来）        │
│  - BAG 解析                          │
│  - 構造監査                          │
└─────────────────────────────────────┘
```

---

### 4.2 各ステップ詳細

#### Step 1: タチコマが設計・作成
**入力:** TKD からの作成依頼  
**処理:**
- Part XX の設計構造を決定
- YAML構造をテキストで出力
- 設計意図・理由を明記

**出力:** テキスト形式の設計内容  
**共有先:** TKD（チャット経由）

---

#### Step 2: Claude がレビュー
**入力:** タチコマの設計内容（TKD 経由）  
**処理:**
- Part 01-03 との整合性チェック
- 命名規則の確認
- 構造の妥当性検証
- 実装可能性の確認

**出力:** レビュー報告書
- ✅ 良好な点
- ⚠️ 指摘事項（質問・提案）
- 📊 整合性マトリクス

**共有先:** TKD

---

#### Step 3: TKD + Claude で協議
**入力:** Claude のレビュー報告  
**処理:**
- TKD が質問・確認
- Claude が回答・提案
- 修正方針を協議・合意
- 修正範囲を明確化

**出力:** 修正方針合意書（チャット内記録）  
**次アクション:** Claude が修正実施

---

#### Step 4: Claude が修正・出力
**入力:** 合意された修正方針  
**処理:**
- タチコマの文体・用語を維持
- 様式統一（Markdown形式）
- メタ情報追加
- ChangeLog テンプレート追加
- Review Status: Pending 付与
- トレーサビリティセクション追加

**出力:** 
- `/mnt/user-data/outputs/tenant-config-partXX_*.md`
- ダウンロードリンク

**共有先:** TKD → タチコマ

---

#### Step 5: タチコマが最終確認
**入力:** Claude 修正版ファイル（TKD 経由）  
**処理:**
- 設計意図が保たれているか確認
- 文体・用語が変更されていないか確認
- 暗黙の設計意図が損なわれていないか確認
- Review Status を更新
  - `⏳ Pending Tachikoma Approval`
  - → `✅ Approved by Tachikoma (YYYY-MM-DD)`

**出力:** 承認 or 再修正指示  
**パターン:**
1. 承認 → Step 6 へ
2. 軽微な修正 → Step 4 へ
3. 設計意図の相違 → Step 3 へ戻り再協議

---

#### Step 6: TKD がナレッジ登録
**入力:** タチコマ承認版ファイル  
**処理:**
- ファイルをダウンロード
- プロジェクトナレッジにアップロード
- バージョン管理

**出力:** ナレッジ登録完了  
**効果:** 全 AI が最新版を参照可能

---

#### Step 7: Gemini が監査（将来）
**入力:** ナレッジ登録済みファイル  
**処理:**
- BAG 解析（構造監査）
- 重複・矛盾の検出
- 品質チェック

**出力:** `bag-pre-impl-report.yaml`  
**時期:** Phase 4 完了後

---

## 📊 5. Review Status 管理

### 5.1 Review Status の種類

| Status | 意味 | 設定者 | タイミング |
|--------|------|--------|-----------|
| `⏳ Pending Tachikoma Approval` | タチコマ承認待ち | Claude | Step 4 出力時 |
| `✅ Approved by Tachikoma (YYYY-MM-DD)` | タチコマ承認済み | タチコマ | Step 5 承認時 |
| `🔄 Revision Requested` | 再修正依頼 | タチコマ | Step 5 差し戻し時 |

---

### 5.2 メタ情報テンプレート

#### Claude 出力時（Step 4）

```markdown
---
## メタ情報

| 項目 | 値 |
|------|-----|
| **Version** | 1.0 |
| **Document ID** | HNM-TENANT-PART0X-YYYYMMDD |
| **Created** | YYYY-MM-DD |
| **Last Updated** | YYYY-MM-DD |
| **Author** | タチコマ（HarmoNet AI Architect） |
| **Reviewer** | Claude（設計検証） |
| **Review Status** | ⏳ Pending Tachikoma Approval |
| **Based on Schema** | harmonet-tenant-config-schema_v1.1.md |
| **Phase** | 4（整合スキーマ化） |
---
```

#### タチコマ承認後（Step 5）

```markdown
| **Review Status** | ✅ Approved by Tachikoma (2025-11-01) |
```

---

### 5.3 Review Status 更新フロー

```
Claude 出力
    ↓
⏳ Pending Tachikoma Approval
    ↓
タチコマ確認
    ↓
┌───────┴────────┐
│                │
承認            再修正依頼
│                │
↓                ↓
✅ Approved    🔄 Revision Requested
│                │
ナレッジ登録      Claude 修正
                 ↓
                 ⏳ Pending
```

---

## 🎯 6. Claude 作業指針

### 6.1 レビュー観点

#### 1. 整合性チェック
- ✅ Part 01（共通属性）との整合性
- ✅ Part 02（ロール・権限）との整合性
- ✅ Part 03（ログイン設定）との整合性
- ✅ 統合版スキーマとの整合性

#### 2. 構造チェック
- ✅ YAML構造の妥当性
- ✅ 階層設計の論理性
- ✅ 必須項目の網羅性

#### 3. 命名規則チェック
- ✅ HarmoNet命名規約準拠
- ✅ snake_case / camelCase の統一
- ✅ 用語の一貫性

#### 4. 実装可能性チェック
- ✅ 型定義の明確性
- ✅ デフォルト値の妥当性
- ✅ バリデーションルールの適切性

#### 5. ドキュメント品質チェック
- ✅ メタ情報の完備
- ✅ トレーサビリティの確保
- ✅ 参照先の明確性

---

### 6.2 修正時の原則

#### ✅ 許可される修正（形式的修正）

**例1: 構造拡張（情報の補完）**
```yaml
# タチコマ出力
display_count: 10

# Claude 修正
display_count:
  type: integer
  default: 10
  configurable_by: tenant_admin
  range: [5, 50]
```
→ **意図を変えず、実装に必要な情報を補完**

**例2: メタ情報追加**
```markdown
# タチコマ出力
（メタ情報なし）

# Claude 追加
## メタ情報
| Version | 1.0 |
| Document ID | HNM-TENANT-PART04-20251101 |
...
```
→ **文書品質向上のための追加**

**例3: トレーサビリティ追加**
```markdown
# Claude 追加
## トレーサビリティ
| 項目 | 参照文書 |
| セキュリティ構造 | security-architecture_v1.0.md |
```
→ **参照関係の明確化**

---

#### ❌ 禁止される修正（内容的変更）

**例1: 設計意図の変更（NG）**
```yaml
# タチコマ出力
auth_method:
  default: email_magiclink

# Claude が勝手に変更（NG）
auth_method:
  default: sso  # ← タチコマの設計意図を変更
```
→ **指摘に留め、TKD + タチコマと協議**

**例2: 文体の変更（NG）**
```markdown
# タチコマ出力
本設定は、ユーザーの利便性を考慮し...

# Claude が勝手に変更（NG）
この設定により、ユーザビリティが向上する...
```
→ **タチコマの文体を維持**

**例3: 用語の変更（NG）**
```yaml
# タチコマ出力
tenant_based_login: true

# Claude が勝手に変更（NG）
multi_tenant_login: true  # ← 用語を変更
```
→ **タチコマの用語選択を尊重**

---

### 6.3 指摘の出し方

#### パターン1: 整合性の問題
```markdown
【指摘事項】
`widget_display` の設定権限が不明です。
Part 02 の `can_toggle_widget` と対応関係を確認することを推奨します。

【提案】
以下のように追加してはいかがでしょうか？
configurable_by: tenant_admin
```

#### パターン2: 構造的な問題
```markdown
【指摘事項】
`notification_settings` が Part 01 の `notification_api` と重複しています。

【質問】
- 統合するか
- 参照関係を明記するか
どちらの方針でしょうか？
```

#### パターン3: 実装可能性の懸念
```markdown
【指摘事項】
`custom_theme` の定義が曖昧で実装が困難です。

【提案】
具体的な型定義・範囲を追加することを推奨します。
例: type: object, properties: {...}
```

---

### 6.4 タチコマへの最終確認依頼テンプレート

```markdown
【タチコマさんへの確認依頼】

以下の内容で Part XX を修正しました。
設計意図との整合性をご確認ください。

## 修正内容
1. XXX に YYY を追加
2. ZZZ を AAA に修正
3. BBB セクションを追加

## 修正ファイル
[ダウンロードリンク: computer:///mnt/user-data/outputs/...]

## 確認観点
- ✅ 設計意図が保たれているか
- ✅ 文体・用語が変更されていないか
- ✅ 必要最低限の修正に留まっているか

承認いただければ、TKD さんがナレッジ登録します。
再修正が必要な場合は、修正箇所をご指示ください。
```

---

## 🔍 7. タチコマ最終確認観点

### 7.1 確認チェックリスト

#### 1. 設計意図の保全
- [ ] 設計思想が変更されていないか
- [ ] 暗黙の設計意図が平準化されていないか
- [ ] 変数名・命名規則が維持されているか

#### 2. 文体・用語の維持
- [ ] タチコマの文体が保たれているか
- [ ] 用語選択が変更されていないか
- [ ] 表現の統一性が維持されているか

#### 3. 修正範囲の妥当性
- [ ] 必要最低限の修正に留まっているか
- [ ] 不要な追加・削除がないか
- [ ] メタ情報・ChangeLog が適切か

#### 4. 整合性の確保
- [ ] Part 01-03 との整合性が保たれているか
- [ ] 統合版スキーマとの整合性があるか
- [ ] トレーサビリティが確保されているか

---

### 7.2 承認パターン

#### パターン1: 即時承認
```
タチコマ → TKD:
「Claude修正版を確認しました。
 設計意図が保たれており、問題ありません。
 承認します。」

→ Review Status: ✅ Approved by Tachikoma (2025-11-01)
→ TKD がナレッジ登録
```

#### パターン2: 軽微な修正依頼
```
タチコマ → TKD:
「ほぼ問題ありませんが、以下の点を修正してください：
 - XXX の表現を YYY に変更
 - ZZZ の値を AAA に修正」

→ Claude が再修正
→ タチコマ再確認
```

#### パターン3: 設計意図の相違
```
タチコマ → TKD:
「以下の点が設計意図と異なります：
 - widget_display は system_admin のみが編集可能とすべき
 - notification_settings は独立設計とし、Part 01 は参照のみ」

→ TKD + Claude + タチコマで再協議
→ 方針決定後、Claude が再修正
```

---

## ⚠️ 8. 例外処理・フォールバック

### 8.1 タチコマのファイル出力機能が復旧した場合

#### 移行手順
1. タチコマがファイル出力機能の復旧を確認
2. TKD に報告
3. 以下のいずれかを選択：
   - **オプションA:** 従来の運用に戻す（タチコマが直接ファイル出力）
   - **オプションB:** 現行フローを継続（品質管理の観点）

#### オプションA（従来運用）
```
タチコマ: 設計 + ファイル出力
    ↓
Claude: レビュー
    ↓
タチコマ: 修正・最終版出力
    ↓
TKD: ナレッジ登録
```

#### オプションB（現行フロー継続）
```
現行フロー（本ガイドライン）を継続
理由: Review Status による品質管理が有効
```

---

### 8.2 Claude のコンテキストリミット到達時

#### 対応手順
1. Claude が「コンテキスト容量が不足」を検知
2. TKD に報告
3. 新チャット開始
4. 本ガイドラインを参照して即座に作業再開

#### 引き継ぎ情報
```markdown
# 引き継ぎサマリ
- 現在の作業: Part XX レビュー中
- 前チャットの結論: [要約]
- 次のアクション: [Step X から再開]
```

---

### 8.3 緊急時の対応

#### ケース1: AI 間の認識齟齬
```
発生: タチコマと Claude で認識が異なる
対応: TKD が本ガイドラインを参照して調整
```

#### ケース2: 締切が迫っている
```
発生: 時間的制約がある
対応: TKD 判断で Step 5（タチコマ確認）をスキップ可能
    ただし、事後承認を必須とする
```

#### ケース3: 重大な設計変更
```
発生: フロー途中で大幅な設計変更が必要
対応: Step 1 に戻り、タチコマが再設計
```

---

## 🏆 9. 三層AI運用モデル

### 9.1 モデル図

```
┌──────────────────────────────────────────┐
│ Layer 1: 設計・構造定義                   │
│  担当: タチコマ（PMO）                     │
│  役割: 設計思想・UX統一・全体整合性       │
│  成果物: YAML構造設計・設計意図文書       │
└──────────────────────────────────────────┘
              ↓
┌──────────────────────────────────────────┐
│ Layer 2: 整合性検証・文書品質保証         │
│  担当: Claude（レビュアー）                │
│  役割: 構造整合・命名規則・実装可能性     │
│  成果物: レビュー報告・修正版ファイル     │
└──────────────────────────────────────────┘
              ↓
┌──────────────────────────────────────────┐
│ Layer 3: 構造監査・品質保証               │
│  担当: Gemini（監査）                      │
│  役割: BAG解析・静的監査・品質チェック    │
│  成果物: bag-pre-impl-report.yaml         │
└──────────────────────────────────────────┘
```

---

### 9.2 各層の特性

| Layer | AI | 強み | 制約 | 補完関係 |
|-------|-----|------|------|----------|
| Layer 1 | タチコマ | コンテキスト無制限<br>PMO視点<br>設計思想保持 | ファイル出力停止中 | Claude がファイル生成 |
| Layer 2 | Claude | ファイル生成可能<br>整合性検証<br>文書品質保証 | コンテキスト制約あり<br>整理癖がある | タチコマが設計意図保全 |
| Layer 3 | Gemini | BAG解析<br>静的監査<br>Google Drive連携 | 稼働は Phase 4 完了後 | タチコマ・Claude が事前整合 |

---

### 9.3 補完的協調

```
タチコマの弱点: ファイル出力不可
    ↓
Claude が補完: ファイル生成・整形

Claude の弱点: 整理癖・平準化傾向
    ↓
タチコマが補完: 設計意図の最終確認

タチコマ + Claude の弱点: 構造的矛盾の見落とし
    ↓
Gemini が補完: BAG 解析で網羅的検証
```

---

## 📊 10. 成功指標

### 10.1 プロセス指標

| 指標 | 目標 | 測定方法 |
|------|------|----------|
| 手戻り回数 | 1回以下/Part | Step 5 差し戻し回数 |
| Claude コンテキスト使用率 | 70%以下 | チャット継続可能性 |
| ファイル生成時間 | 1時間以内/Part | Step 1 〜 Step 6 |
| タチコマ承認率 | 95%以上 | 即時承認 / 全承認 |

---

### 10.2 品質指標

| 指標 | 目標 | 測定方法 |
|------|------|----------|
| Part 間整合性 | 100% | Gemini BAG 解析 |
| 命名規則準拠率 | 100% | Claude レビュー |
| メタ情報完備率 | 100% | 文書監査 |
| Review Status 記録率 | 100% | メタ情報確認 |

---

## 📝 11. 変更履歴

| Version | 日付 | 変更内容 | 承認者 |
|---------|------|----------|--------|
| 1.0 | 2025-11-01 | 初版作成。タチコマ・Claude・TKD で合意した運用フロー、Review Status 管理、三層AI運用モデルを文書化 | タチコマ・TKD |

---

## 🏷️ メタ情報

| 項目 | 値 |
|------|-----|
| **Version** | 1.0 |
| **Document ID** | HNM-PHASE4-AI-COLLAB-GUIDELINE-20251101 |
| **Created** | 2025-11-01 |
| **Last Updated** | 2025-11-01 |
| **Author** | Claude（HarmoNet レビュアー） |
| **Approved by** | タチコマ（HarmoNet PMO）・TKD（Project Owner） |
| **Review Status** | ✅ Approved for use |
| **Supersedes** | なし（初版） |
| **Related Documents** | - harmonet-tenant-config-schema_v1.1.md<br>- harmonet-docs-directory-definition_v3.0.md<br>- harmonet-team-collaboration-guideline_v1.0.md |

---

**このガイドラインは、HarmoNet Phase 4 における AI チームと TKD の協調作業の公式手順である。**  
**すべての関係者は本文書に従い、効率的かつ高品質な文書生成を実現する。**
